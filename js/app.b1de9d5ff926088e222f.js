"use strict";(self.webpackChunksim_firefighter=self.webpackChunksim_firefighter||[]).push([[524],{980:(e,t,i)=>{var s=i(440);class n extends Phaser.Scene{constructor(){super({key:"MenuScene"}),console.log("MenuScene Constructor Called")}preload(){this.load.image("game menu","assets/game-menu.png"),this.load.image("start tutorial","assets/tutorial icons/tutorial-button.png"),this.load.image("play game","assets/tutorial icons/play-button.png"),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}create(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY,i=this.cameras.main.width,s=this.cameras.main.height;WebFont.load({google:{families:["Press Start 2P"]},active:()=>{this.createMenuElements()}}),this.add.rectangle(e,t,i,s,2962486,.7);const n=this.add.image(e,t,"game menu").setOrigin(.5),r=i/n.width,a=s/n.height,o=Math.max(r,a);n.setScale(o).setAlpha(.5),this.add.text(e,t-150,"WILDFIRE COMMAND",{fontFamily:'"Press Start 2P"',fontSize:"45px",color:"#ffffff",stroke:"#ff6600",strokeThickness:6,shadow:{offsetX:2,offsetY:2,color:"#000",blur:2,stroke:!0,fill:!0}}).setOrigin(.5),this.createStyledButtons()}createMenuElements(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY;this.add.text(e,t-90,"Firefighting Simulation",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#ffffff",align:"center"}).setOrigin(.5)}createStyledButtons(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY,i=this.createButton(e,t-20,250,60,"Tutorial",2263842,(()=>{console.log("tutorial!"),this.scene.stop("MenuScene"),this.scene.start("TutorialScene")})),s=this.createButton(e,t+70,250,60,"Play Game",9109504,(()=>{console.log("play!"),this.scene.start("MapScene"),this.scene.launch("UIScene")}));this.tweens.add({targets:i,y:i.y-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:s,y:s.y+5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",delay:200})}createButton(e,t,i,s,n,r,a){const o=this.add.container(e,t),l=this.add.rectangle(0,0,i,s,r,1).setStrokeStyle(3,16777215,.8).setOrigin(.5),h=this.add.text(0,0,n,{fontFamily:'"Press Start 2P"',fontSize:"18px",color:"#ffffff",align:"center"}).setOrigin(.5);return o.add([l,h]),l.setInteractive({useHandCursor:!0}).on("pointerover",(()=>{const e=2263842===r?3050327:10824234;l.setFillStyle(e),this.tweens.add({targets:o,scaleX:1.05,scaleY:1.05,duration:100})})).on("pointerout",(()=>{l.setFillStyle(r),this.tweens.add({targets:o,scaleX:1,scaleY:1,duration:100})})).on("pointerdown",(()=>{this.tweens.add({targets:o,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:a})})),o}}function r(e,{x:t,y:i,width:s=80,height:n=30,backgroundColor:r=9109504,hoverColor:a=10824234,text:o="Button",fontSize:l="10px",onClick:h=()=>{}}){const c=e.add.rectangle(t,i,s,n,r).setOrigin(.5).setInteractive().setScrollFactor(0).setDepth(10),d=e.add.text(t,i,o,{fontFamily:'"Press Start 2P"',fontStyle:"normal",fontSize:l,color:"#FFFFFF",align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(11);return c.on("pointerover",(()=>c.setFillStyle(a))),c.on("pointerout",(()=>c.setFillStyle(r))),c.on("pointerdown",(()=>{e.tweens.add({targets:[c,d],scaleX:.9,scaleY:.9,duration:100,ease:"Power2"})})),c.on("pointerup",(()=>{e.tweens.add({targets:[c,d],scaleX:1,scaleY:1,duration:100,ease:"Power2",onComplete:h})})),{button:c,buttonText:d}}let a=10,o=5,l=3,h=3,c=2,d=2,u=5;function p(){return a}function g(e){a+=e}function m(){return o}function f(e){o+=e}function x(){return l}function S(e){l+=e}function y(){return h}function b(e){h+=e}function w(){return c}function F(e){c+=e}function T(){return d}function I(e){d+=e}function C(){return u}function P(e){u+=e}let k={x:null,y:null},v={x:null,y:null},E={x:null,y:null},M=0;class _ extends Phaser.Scene{constructor(){super({key:"TutorialScene"}),console.log("TutorialScene Constructor Called")}preload(){this.load.image("page 1","assets/tutorial icons/page-1.png"),this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"),this.load.image("dialog","assets/tutorial/dialog.png"),this.load.image("firefighter","assets/tutorial/firefighter.png"),this.load.text("text","assets/myTextFile.txt")}create(){this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,"undefined"!=typeof WebFont?WebFont.load({google:{families:["Press Start 2P"]},active:()=>{this.scene.launch("MapScene"),this.time.delayedCall(2e3,(()=>this.createTutorialContent()))}}):(this.scene.launch("MapScene"),this.time.delayedCall(2e3,(()=>this.createTutorialContent())))}createTutorialContent(e){this.scene.bringToTop("TutorialScene");const t=this.cameras.main.centerX,i=this.cameras.main.centerY,s=this.cameras.main.width,n=this.cameras.main.height,p=this.add.rectangle(t,i,s,n,2962486).setAlpha(.9);r(this,{x:35,y:35,width:40,height:40,backgroundColor:9109504,hoverColor:10824234,text:"<-",fontFamily:'"Press Start 2P"',fontSize:"16px",onClick:()=>{this.scene.stop("TutorialScene"),this.scene.stop("MapScene"),this.scene.stop("UIScene"),window.location.reload()}}),k=this.add.sprite(t,i,"firefighter").setOrigin(.5).setScale(4).setX(this.cameras.main.width/1.6).setY(this.cameras.main.height/1.6),v=this.add.sprite(t,i,"dialog").setOrigin(.5).setScale(5).setX(t).setY(i+50),fetch("tutorialDialog.txt").then((e=>e.text())).then((e=>{let s=this.add.rectangle(t,i,this.cameras.main.width,this.cameras.main.height,"0x9ff86f",0).setX(t).setY(i).setStrokeStyle(5,16777215,0).setOrigin(.5).setAlpha(.5);E=this.add.text(t,i,e.split("\n")[0],{fontFamily:'"Press Start 2P"',fontSize:"20px",color:"#000000",wordWrap:{width:300,useAdvancedWrap:!0},align:"center"}).setOrigin(.5).setX(t).setY(i+50),M=1;let n=!1;s.alwaysEnabled=!1,this.input.on("pointerdown",(r=>{s.getBounds().contains(r.x,r.y)&&(console.log(`D_COUNT: ${M}`),E.setText(e.split("\n")[M]),!1===n&&(M+=1),M>=17&&(p.setAlpha(0),k.x=t-230,k.y=i+120,k.flipX=!0,k.setScale(2),v.x=t-180,v.y=i+50,v.flipX=!0,v.setScale(3),E.setFontSize("14px"),E.setStyle({wordWrap:{width:200,useAdvancedWrap:!0}}),E.x=t-170,E.y=i+55),M<27&&(0!==a&&0!==o&&0!==l&&0!==h&&0!==c&&0!==d&&0!==u||(this.scene.pause("MapScene"),v.setVisible(!0),E.setVisible(!0),!0===n&&(M+=1),n=!1)))}))}))}update(){M<17&&(k.x=this.scale.width/1.6,k.y=this.scale.height-225)}}class O{constructor(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s,this.left=null,this.right=null}isLeaf(){return null===this.left&&null===this.right}}const A=class{constructor(e,t,i){this.root=new O(0,0,e,t),this.minPartitionSize=i}partition(e=this.root){if(!e.isLeaf())return!1;if(e.width<=this.minPartitionSize||e.height<=this.minPartitionSize)return!1;let t=Math.random()>.5;e.width>e.height&&e.width/e.height>=1.25?t=!1:e.height>e.width&&e.height/e.width>=1.25&&(t=!0);const i=(t?e.height:e.width)-this.minPartitionSize;if(i<=this.minPartitionSize)return!1;const s=Math.floor(Math.random()*(i-this.minPartitionSize+1)+this.minPartitionSize),n=(t?e.height:e.width)-s;return!(s<this.minPartitionSize||n<this.minPartitionSize||(t?(e.left=new O(e.x,e.y,e.width,s),e.right=new O(e.x,e.y+s,e.width,e.height-s)):(e.left=new O(e.x,e.y,s,e.height),e.right=new O(e.x+s,e.y,e.width-s,e.height)),console.log(`Partitioned node at (${e.x}, ${e.y}, ${e.width}, ${e.height})`),console.log(`Left: (${e.left.x}, ${e.left.y}, ${e.left.width}, ${e.left.height})`),console.log(`Right: (${e.right.x}, ${e.right.y}, ${e.right.width}, ${e.right.height})`),0))}partitionAll(e=this.root){this.partition(e)&&(this.partitionAll(e.left),this.partitionAll(e.right))}getPartitions(e=this.root,t=[]){return e.isLeaf()?t.push(e):(e.left&&this.getPartitions(e.left,t),e.right&&this.getPartitions(e.right,t)),t}visualizePartitions(){const e=this.getPartitions();console.log("Visualizing Partitions:"),e.forEach(((e,t)=>{console.log(`Partition ${t+1}: (${e.x}, ${e.y}, ${e.width}, ${e.height})`)}))}};class D{static FLAM_GRASS=.65;static FUEL_GRASS=2;static FLAM_SHRUB=.85;static FUEL_SHRUB=4;static FLAM_TREE=.3;static FUEL_TREE=6;static FLAM_WATER=0;static FUEL_WATER=0;static FLAM_GRASS_HOUSE=.7;static FUEL_GRASS_HOUSE=2;static FLAM_SAND_HOUSE=.3;static FUEL_SAND_HOUSE=4;static FLAM_DIRT_HOUSE=.5;static FUEL_DIRT_HOUSE=6;constructor(e,t,i){this.x=e,this.y=t,this.terrain=i,this.burnStatus="unburned",this._crownFired=!1;const s=this.getTerrainAttributes(i);this.flammability=s.flammability,this.fuel=s.fuel,this.initialFuel=this.fuel}getTerrainAttributes(e){return{grass:{flammability:D.FLAM_GRASS,fuel:D.FUEL_GRASS},shrub:{flammability:D.FLAM_SHRUB,fuel:D.FUEL_SHRUB},tree:{flammability:D.FLAM_TREE,fuel:D.FUEL_TREE},water:{flammability:D.FLAM_WATER,fuel:D.FUEL_WATER},"grass-house":{flammability:D.FLAM_GRASS_HOUSE,fuel:D.FUEL_GRASS_HOUSE},"sand-house":{flammability:D.FLAM_SAND_HOUSE,fuel:D.FUEL_SAND_HOUSE},"dirt-house":{flammability:D.FLAM_DIRT_HOUSE,fuel:D.FUEL_DIRT_HOUSE}}[e]||{flammability:0,fuel:0}}toString(){return`{ x: ${this.x}, y: ${this.y}, terrain: '${this.terrain}', flammability: ${this.flammability}, fuel: ${this.fuel}, burnStatus: '${this.burnStatus}' }`}}const R=16,N=256,U=4095;let L;function H(e){const t=(()=>{const e=4294967296;let t,i;return{setSeed:s=>{i=t=(void 0===s?Math.random()*e:s)>>>0},getSeed:()=>t,rand:()=>(i=(1664525*i+1013904223)%e)/e}})();t.setSeed(e),L=new Array(4096);for(let e=0;e<4096;e++)L[e]=t.rand()}function B(e){return e*e*e*(e*(6*e-15)+10)}function G(e,t,i){return(1-i)*e+i*t}const W={seed:H,perlin2:function(e,t){void 0===L&&H(Math.random());const i=Math.floor(e),s=Math.floor(t),n=t-s,r=B(e-i),a=B(n),o=G(L[(i&U)+(s&U)*R],L[(i+1&U)+(s&U)*R],r),l=G(L[(i&U)+(s+1&U)*R],L[(i+1&U)+(s+1&U)*R],r);return G(o,l,a)},perlin3:function(e,t,i){void 0===L&&H(Math.random());const s=Math.floor(e),n=Math.floor(t),r=Math.floor(i),a=t-n,o=i-r,l=B(e-s),h=B(a),c=(B(o),G(L[(s&U)+(n&U)*R+(r&U)*N],L[(s+1&U)+(n&U)*R+(r&U)*N],l)),d=G(L[(s&U)+(n+1&U)*R+(r&U)*N],L[(s+1&U)+(n+1&U)*R+(r&U)*N],l);return G(c,d,h)}};class z{constructor(e,t,i=5,s=Math.random()){this.width=e,this.height=t,this.scale=i;const n="string"==typeof s?this.stringToNumber(s):s;W.seed(n),this.noiseGrid=this.generateNoiseGrid()}stringToNumber(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t)/1e3}generateNoiseGrid(){const e=[];for(let t=0;t<this.height;t++){const i=[];for(let e=0;e<this.width;e++){const s=W.perlin2(e/this.scale,t/this.scale);i.push(s)}e.push(i)}return e}setSeed(e){const t="string"==typeof e?this.stringToNumber(e):e;W.seed(t),this.noiseGrid=this.generateNoiseGrid()}getNoise(e,t){if(e>=this.width||t>=this.height||e<0||t<0)throw new RangeError("Coordinates out of bounds");return this.noiseGrid[t][e]}}class V{static apply(e){const t=JSON.parse(JSON.stringify(e));for(let i=1;i<e.length-1;i++)for(let s=1;s<e[0].length-1;s++){const n=this.getNeighborCounts(e,s,i);e[i][s].terrain.includes("house")||(n.tree>4?t[i][s].terrain="tree":n.grass>5?t[i][s].terrain="grass":n.water>5&&(t[i][s].terrain="water"))}return this.seedAndGrowNeighborhoods(t),this.createNeighborhoods(t),t}static seedAndGrowNeighborhoods(e){let t=0;for(let i=0;i<5&&t<50;i++){let i=!1;for(;!i&&t<50;){const s=Math.floor(Math.random()*e[0].length),n=Math.floor(Math.random()*e.length),r=e[n][s],a=this.getNeighborCounts(e,s,n);if("grass"===r.terrain&&0===a.water){const t=6+Math.floor(5*Math.random());this.growNeighborhood(e,s,n,t),i=!0}t++}}}static growNeighborhood(e,t,i,s){const n=[{x:t,y:i}],r=new Set;let a=0;const o=(e,t)=>`${e},${t}`;for(;n.length>0&&a<s;){const{x:t,y:i}=n.shift();if(t>=0&&i>=0&&i<e.length&&t<e[0].length&&"grass"===e[i][t].terrain&&!r.has(o(t,i))){e[i][t].terrain="grass-house",r.add(o(t,i)),a++;const s=this.shuffle([{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}]);for(const{dx:e,dy:a}of s){const s=t+e,l=i+a;r.has(o(s,l))||n.push({x:s,y:l})}}}}static shuffle(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}static createNeighborhoods(e){const t=[];for(let i=0;i<e.length;i++)for(let s=0;s<e[0].length;s++)e[i][s].terrain.includes("house")&&t.push({x:s,y:i,tile:e[i][s]});this.clusterHouses(t).forEach((t=>{this.enhanceNeighborhood(e,t)}))}static clusterHouses(e){if(0===e.length)return[];const t=[],i=new Set;return e.forEach(((s,n)=>{if(i.has(n))return;const r=[s];i.add(n),e.forEach(((e,t)=>{n===t||i.has(t)||Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))<=5&&(r.push(e),i.add(t))})),t.push(r)})),t}static enhanceNeighborhood(e,t){if(!(t.length<=1)){for(let i=0;i<t.length-1;i++)this.createPath(e,t[i],t[i+1]);t.forEach((t=>{this.addLandscaping(e,t)}))}}static createPath(e,t,i){let[s,n]=[t.x,t.y],[r,a]=[i.x,i.y];const o=Math.abs(r-s),l=Math.abs(a-n),h=s<r?1:-1,c=n<a?1:-1;let d=o-l;for(;;){if(!(s===t.x&&n===t.y||s===i.x&&n===i.y)&&n>=0&&n<e.length&&s>=0&&s<e[n].length){const t=e[n][s];t&&"water"!==t.terrain&&!t.terrain.includes("house")&&Math.random()<.7&&(t.terrain="grass")}if(s===r&&n===a)break;const u=2*d;u>-l&&(d-=l,s+=h),u<o&&(d+=o,n+=c)}}static addLandscaping(e,t){for(let i=t.y-2;i<=t.y+2;i++)for(let s=t.x-2;s<=t.x+2;s++)if((s!==t.x||i!==t.y)&&i>=0&&i<e.length&&s>=0&&s<e[i].length){const t=e[i][s];t&&"water"!==t.terrain&&!t.terrain.includes("house")&&Math.random()<.6&&(t.terrain="grass")}}static getNeighborCounts(e,t,i){const s={tree:0,grass:0,shrub:0,water:0,"dirt-house":0,"grass-house":0,"sand-house":0};return[e[i-1]?.[t-1],e[i-1]?.[t],e[i-1]?.[t+1],e[i]?.[t-1],e[i]?.[t+1],e[i+1]?.[t-1],e[i+1]?.[t],e[i+1]?.[t+1]].forEach((e=>{e&&(void 0!==s[e.terrain]?s[e.terrain]++:s[e.terrain]=1)})),s}}class Z{constructor(e,t,i,s=Date.now()+Math.random()){this.width=e,this.height=t,this.minSize=i,this.perlin=new z(e,t,5,s),this.bsp=new A(e,t,i),this.bsp.visualizePartitions(),this.grid=this.generateMap()}regenerateMap(e){this.perlin.setSeed(e),this.grid=this.generateMap()}generateMap(e){const t=Array.from({length:this.height},(()=>Array(this.width).fill(null))),i=this.bsp.getPartitions();0===i.length&&(console.error("BSPPartition failed to create any partitions. Falling back to single-partition grid."),i.push({x:0,y:0,width:this.width,height:this.height})),i.forEach((e=>{for(let i=e.y;i<e.y+e.height;i++)for(let s=e.x;s<e.x+e.width;s++){const e=this.perlin.getNoise(s,i),n=this.getTerrainFromNoise(e);t[i][s]=new D(s,i,n)}}));let s=0,n=0;for(let e=0;e<200;e++)s=Math.floor(98*Math.random()+1),n=Math.floor(98*Math.random()+1),"shrub"===t[n][s].terrain?t[n][s]=new D(s,n,"sand-house"):"tree"===t[n][s].terrain?t[n][s]=new D(s,n,"dirt-house"):"grass"===t[n][s].terrain?t[n][s]=new D(s,n,"grass-house"):"water"===t[n][s].terrain&&--e;return V.apply(t)}getTerrainFromNoise(e){let t="shrub";return e<.2?t="water":e<.4?t="tree":e<.7&&(t="grass"),t}printMap(){this.grid.forEach((e=>{console.log(e.map((e=>e.terrain)).join(" | "))}))}printBurnStatusMap(){this.grid.forEach((e=>{console.log(e.map((e=>e.burnStatus)).join(" | "))}))}getTile(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height?this.grid[t][e]:null}}const $=class{constructor(e,t){this.map=e,this.weather=t}simulateFireStep(){const e=[];for(let t=0;t<this.map.height;t++)for(let i=0;i<this.map.width;i++){const s=this.map.grid[t][i];"burning"===s.burnStatus&&e.push({tile:s,x:i,y:t})}if(0===e.length)return 0;let t=0;return e.forEach((({tile:e,x:i,y:s})=>{t+=this.processBurningTile(e,this.map.grid,i,s)})),e.length}copyGrid(){return this.map.grid.map((e=>e.map((e=>new D(e.x,e.y,e.terrain)))))}updateSprite(e,t){let i;if("object"==typeof e)i=e;else{if(!(this.map&&this.map.grid&&t>=0&&t<this.map.grid.length&&e>=0&&e<this.map.grid[t].length))return void console.warn("FireSpread: Invalid coordinates for updateSprite");i=this.map.grid[t][e]}if(i&&i.sprite&&i.sprite.scene&&i.sprite.scene.sys)try{i.sprite.setTexture(i.terrain)}catch(e){console.warn("FireSpread: Error updating tile sprite texture",e)}}processBurningTile(e,t,i,s){let n=this.spreadFire(e,i,s,t),r=t[s][i];return e.fuel=Math.max(0,r.fuel-1),0===e.fuel&&(e.burnStatus="burnt",e.fireS&&(e.fireS.extinguishFire(),"grass"===e.terrain?e.terrain="burned-grass":"shrub"===e.terrain?e.terrain="burned-shrub":"tree"===e.terrain?e.terrain="burned-tree":"grass-house"===e.terrain?e.terrain="burned-grass-house":"sand-house"===e.terrain?e.terrain="burned-sand-house":"dirt-house"===e.terrain&&(e.terrain="burned-dirt-house"),this.updateSprite(i,s)),this.updateSprite(i,s)),n}spreadFire(e,t,i,s){const n=this.getNeighbors(t,i);let r=0,a=0;"tree"===e.terrain&&(a=30);for(const e of n){const n=s[e.y][e.x];if("unburned"===n.burnStatus&&"fire-break"!==n.terrain&&this.canIgnite(n)){const s=this.isTileDownwind({x:t,y:i},e);r+=this.attemptIgnite(n,s,a)}}return r}isTileDownwind(e,t){const i=this.weather.windDirection;return"N"===i&&t.y>e.y||"S"===i&&t.y<e.y||"E"===i&&t.x<e.x||"W"===i&&t.x>e.x}canIgnite(e){return"unburned"===e.burnStatus&&e.flammability>0}attemptIgnite(e,t,i=0){if("unburned"!==e.burnStatus||e.flammability<=0)return 0;let s=this.calculateIgnitionChance(e);return s*=.25,t&&(s+=.7*this.weather.windSpeed),s+=i,s*={low:.5,medium:1,high:1.5}[this.weather.getRiskCategory()],100*Math.random()<s?(e.burnStatus="burning",1):0}getNeighbors(e,t){return[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}].map((i=>({x:e+i.x,y:t+i.y}))).filter((e=>e.x>=0&&e.x<this.map.width&&e.y>=0&&e.y<this.map.height))}calculateIgnitionChance(e){let t=100*e.flammability+this.getWeatherInfluenceFromWeather();return"tree"===e.terrain&&(t*=.9),t}getWeatherInfluenceFromWeather(){return this.weather.getWeatherInfluence()}},Y=class{constructor(e=68,t=70,i=10,s="N"){this.temperature=e,this.humidity=t,this.windSpeed=i,this.windDirection=s,this.ageHours=0}updateOverTime(e){this.temperature=parseFloat((50+20*Math.sin(2*Math.PI*(this.ageHours/24))).toFixed(1)),this.humidity=parseFloat((80-.5*(this.temperature-32)).toFixed(1)),this.windSpeed=parseFloat(Phaser.Math.Clamp(this.windSpeed+Phaser.Math.FloatBetween(-2,2),0,30).toFixed(1)),Math.random()<.01&&(this.windDirection=["N","S","E","W"][Phaser.Math.Between(0,3)]),this.ageHours+=e/3600,this.ageHours=parseFloat(this.ageHours.toFixed(2))}getRiskCategory(){const e=this.getWeatherInfluence();return e<3?"low":e<7?"medium":"high"}getWeatherInfluence(e=null){let t=0;return t+=.1*(this.temperature-32),t-=.02*this.humidity,t+=.5*this.windSpeed,t+=1.5,e&&e===this.windDirection&&(t+=.7*this.windSpeed),parseFloat(t.toFixed(2))}};let X,j,K,J,q,Q,ee,te,ie,se,ne,re,ae,oe,le,he,ce,de,ue,pe,ge,me,fe,xe,Se=0,ye=0,be=0,we=0,Fe=0,Te=0,Ie=0,Ce=0,Pe=0;function ke(e,t){e.panel.setVisible(t),e.title.setVisible(t),e.close.setVisible(t),e.closeText.setVisible(t),e.totalLabel.setVisible(t),e.totalText.setVisible(t),e.purchase.setVisible(t),e.purchaseText.setVisible(t),e.items.forEach((e=>{e.bg.setVisible(t),e.icon.setVisible(t),e.minusBtn.setVisible(t),e.minusText.setVisible(t),e.plusBtn.setVisible(t),e.plusText.setVisible(t),e.countText.setVisible(t),e.priceText.setVisible(t)}))}function ve(e){switch(e){case"hose":return{value:ye,setValue:e=>{ye=e}};case"extinguisher":return{value:be,setValue:e=>{be=e}};case"helicopter":return{value:we,setValue:e=>{we=e}};case"firetruck":return{value:Fe,setValue:e=>{Fe=e}};case"airtanker":return{value:Te,setValue:e=>{Te=e}};case"hotshotcrew":return{value:Ie,setValue:e=>{Ie=e}};case"smokejumper":return{value:Ce,setValue:e=>{Ce=e}};default:return{value:0,setValue:()=>{}}}}let Ee,Me,_e,Oe,Ae,De,Re,Ne,Ue,Le,He=[];function Be(e,t){return e.setStyle({fontFamily:'"Press Start 2P"',fontSize:"10px",color:"#FFFFFF",backgroundColor:"#333333",padding:{x:6,y:4}}),t.add.rectangle(e.x,e.y,e.width+12,e.height+8,3355443,.7).setOrigin(.5).setDepth(e.depth-1)}let Ge="",We="none",ze="cursor",Ve=null;function Ze(e){return e&&"burning"!==e.burnStatus&&"burnt"!==e.burnStatus&&!["water","burned-grass","burned-shrub","burned-tree","burned-grass-house","burned-sand-house","burned-dirt-house"].includes(e.terrain)}let $e=[0,0,0,0,0,0,0],Ye=0;const Xe={hose:100,extinguisher:50,helicopter:300,firetruck:200,airtanker:500,"hotshot-crew":300,smokejumper:1e3};function je(){return Ye}function Ke(e){return Ye-=e,!(Ye<0&&(Ye+=e,1))}function Je(e){for(let t=0;t<=6;t++){let i=e[t];`${We}`===i.name&&(i.setTexture(i.name),Ge="NO-WATER",We="none")}}function qe(e,t,i,s=1){const n=e.fuel;if(e.fuel=Math.max(0,e.fuel-s),0===e.fuel){Ye+=Xe[We]||0,X.setText(`${Ye}`),i.events.emit("extinguishFire",t)}else n>s&&it(i,"ðŸ”¥ Not enough power to fully extinguish fire!")}function Qe(e,t,i,s){if(e&&e.sprite&&"extinguished"!==e.burnStatus&&"burnt"!==e.burnStatus){if("burning"===e.burnStatus){Ye+=Xe[We]||0,X.setText(`${Ye}`),s.events.emit("extinguishFire",e.sprite)}"not-burnt"===e.burnStatus?(e.terrain="fire-break",s.fireSpread.updateSprite(t,i)):(e.burnStatus="extinguished",e.terrain.includes("grass")||"grass"===e.terrain?e.terrain="extinguished-grass":e.terrain.includes("shrub")||"shrub"===e.terrain?e.terrain="extinguished-shrub":(e.terrain.includes("tree")||"tree"===e.terrain)&&(e.terrain="extinguished-tree"),s.fireSpread.updateSprite(t,i))}}function et(e,t,i,s,n,r,a,o){console.log(`Resource Activated: ${i}`),t.setInteractive(),t.on("pointerdown",(function(e,l,h,c){"none"!==We||yt?We!==i||yt?yt||(Je(He),t.setTexture("active-"+i),o.input.setDefaultCursor("url("+s+"), pointer"),Ge=r,We=`${i}`,ze="deployment"):(Je(He),t.setTexture(i),Ge=a,o.input.setDefaultCursor("url("+n+"), pointer"),ze="cursor"):(t.setTexture("active-"+i),o.input.setDefaultCursor("url("+s+"), pointer"),Ge=r,We=`${i}`,ze="deployment")}),this)}function tt(e,t,i,s,n){let r=function(e){switch(e.replace("-tooltip","")){case"hose":return"FIRE HOSE\n\nBasic firefighting tool.\nReduces fuel by 3.\nSingle tile coverage.";case"extinguisher":return"FIRE EXTINGUISHER\n\nQuick deployment.\nReduces fuel by 2.\nSingle tile coverage.";case"helicopter":return"HELICOPTER\n\nAerial water drops.\nFully extinguishes.\nAffects 5 tiles in cross pattern.";case"firetruck":return"FIRE TRUCK\n\nStrong water pressure.\nReduces fuel by 4.\nSingle tile coverage.";case"airtanker":return"AIR TANKER\n\nLarge retardant drop.\nFully extinguishes.\nAffects 5 tiles in a line.";case"hotshot-crew":return"HOTSHOT CREW\n\nCreates firebreaks.\nWorks on UNBURNED tiles only.\nProtects line of 5 tiles.";case"smokejumper":return"SMOKEJUMPERS\n\nParachute into remote areas.\nImmediately extinguishes.\nSingle tile coverage.";default:return"Resource information unavailable"}}(t);const a=i-50;let o=n.add.text(a,s,r,{fontFamily:'"Press Start 2P"',fontSize:"10px",color:"#FFFFFF",backgroundColor:"#2d3436",padding:{x:10,y:8},align:"center",wordWrap:{width:180}}).setOrigin(.5,.5).setDepth(1e3).setScrollFactor(0).setVisible(!1);const l=o.getBounds(),h=n.add.rectangle(a,s,l.width+5,l.height+5,16777215,.3).setDepth(999).setScrollFactor(0).setVisible(!1);e.on("pointerover",(function(){o.setVisible(!0),h.setVisible(!0)})),e.on("pointerout",(function(){o.setVisible(!1),h.setVisible(!1)}))}function it(e,t,i=null){t?.setText&&null===i?(t.setText(i).setVisible(!0),e.time.delayedCall(2e3,(()=>t.setVisible(!1)))):"string"==typeof t?(e.fallbackNotificationText||(e.fallbackNotificationText=e.add.text(e.scale.width/2,e.scale.height-160,"",{fontFamily:'"Press Start 2P"',fontSize:"10px",color:"#ff5555",backgroundColor:"#000000",padding:{x:10,y:4}}).setOrigin(.5).setDepth(999).setScrollFactor(0).setVisible(!1)),e.fallbackNotificationText.setText(t).setVisible(!0),e.time.delayedCall(2e3,(()=>e.fallbackNotificationText.setVisible(!1)))):(t.setVisible(!0),e.time.delayedCall(1e3,(()=>{t.setVisible(!1)})))}function st(e,t,i,s,n=null){if("hose"===We){if(p()<=0)return void it(e,ne);if($e[0]>0)return void it(e,se)}else if("extinguisher"===We){if(m()<=0)return void it(e,re);if($e[1]>0)return void it(e,se)}else if("helicopter"===We){if(x()<=0)return void it(e,ae);if($e[2]>0)return void it(e,se)}else if("firetruck"===We){if(y()<=0)return void it(e,oe);if($e[3]>0)return void it(e,se)}if(!n&&("airtanker"===We||"hotshot-crew"===We))return Ve={scene:e,x:t,y:i,fireSprite:s},void e.scene.get("UIScene").directionPromptContainer.setVisible(!0);if("airtanker"===We){if(w()<=0)return void it(e,le);if($e[4]>0)return void it(e,se)}else if("hotshot-crew"===We){if(T()<=0)return void it(e,he);if($e[5]>0)return void it(e,se)}else if("smokejumper"===We){if(C()<=0)return void it(e,ce);if($e[6]>0)return void it(e,se)}let r=new ut(3);if("hose"!==We||yt)if("extinguisher"!==We||yt)if("helicopter"!==We||yt)if("firetruck"!==We||yt)if("airtanker"!==We||yt)if("hotshot-crew"!==We||yt)"smokejumper"!==We||yt||(P(-1),r.useSmokejumpers(e,t,i,s),C()%4==0&&r.startTimer(6,e,e.game.scale.width-50,550),e.time.delayedCall(ct+dt,(()=>{e.events.emit("extinguishFire",s),X.setText(`${Ye}`)})));else{const s=e.scene.get("MapScene"),r=Math.floor(t/s.TILE_SIZE),a=Math.floor(i/s.TILE_SIZE);if(!Ze(s.map.grid[a][r]))return void it(e,"Hotshots can only deploy on unburned, modifiable tiles!");const o=new ut(3);o.useHotshotCrew(e,t,i),I(-1),T()%3==0&&o.startTimer(5,e,3e3,e.game.scale.width-50,465),e.time.delayedCall(ht,(()=>{("vertical"===(n||dropDirection)?[[0,0],[0,-2],[0,-1],[0,1],[0,2]]:[[0,0],[-2,0],[-1,0],[1,0],[2,0]]).forEach((([e,t])=>{const i=r+e,n=a+t;if(i>=0&&i<s.map.width&&n>=0&&n<s.map.height){const e=s.map.grid[n][i];Ze(e)&&(e.terrain="fire-break",s.fireSpread.updateSprite(i,n))}})),X.setText(`${Ye}`)}))}else F(-1),r.useAirtanker(e,t,i,s),w()%2==0&&r.startTimer(4,e,1e4,e.game.scale.width-50,380),e.time.delayedCall(lt,(()=>{const s=e.scene.get("MapScene"),r=Math.floor(t/s.TILE_SIZE),a=Math.floor(i/s.TILE_SIZE);("vertical"===(n||dropDirection)?[[0,-2],[0,-1],[0,0],[0,1],[0,2]]:[[-2,0],[-1,0],[0,0],[1,0],[2,0]]).forEach((([e,t])=>{const i=r+e,n=a+t;if(i>=0&&i<s.map.width&&n>=0&&n<s.map.height){const e=s.map.grid[n][i];"burnt"!==e.burnStatus&&Qe(e,i,n,s)}})),X.setText(`${Ye}`)}));else b(-1),r.useFiretruck(e,t,i,s),y()%5==0&&r.startTimer(3,e,5e3,e.game.scale.width-50,295),e.time.delayedCall(at,(()=>{const t=e.scene.get("MapScene"),i=Math.floor(s.x/t.TILE_SIZE),n=Math.floor(s.y/t.TILE_SIZE);qe(t.map.grid[n][i],s,t,4),X.setText(`${Ye}`)}));else S(-1),r.useHelicopter(e,t,i,s),x()%2==0&&r.startTimer(2,e,7e3,e.game.scale.width-50,210),e.time.delayedCall(ot,(()=>{const t=e.scene.get("MapScene"),i=t.TILE_SIZE,n=Math.floor(s.x/i),r=Math.floor(s.y/i);[[0,0],[0,-1],[0,1],[1,0],[-1,0]].forEach((([e,i])=>{const s=n+e,a=r+i;s>=0&&s<t.map.width&&a>=0&&a<t.map.height&&Qe(t.map.grid[a][s],s,a,t)})),X.setText(`${Ye}`)}));else f(-1),r.useFireExtinguisher(e,t,i,s),m()%5==0&&r.startTimer(1,e,500,e.game.scale.width-50,125),e.time.delayedCall(rt,(()=>{const t=e.scene.get("MapScene"),i=Math.floor(s.x/t.TILE_SIZE),n=Math.floor(s.y/t.TILE_SIZE);qe(t.map.grid[n][i],s,t,2),X.setText(`${Ye}`)}));else g(-1),r.useHose(e,t,i,s),p()%5==0&&r.startTimer(0,e,3e3,e.game.scale.width-50,40),e.time.delayedCall(nt,(()=>{const t=e.scene.get("MapScene"),i=Math.floor(s.x/t.TILE_SIZE),n=Math.floor(s.y/t.TILE_SIZE);qe(t.map.grid[n][i],s,t,3),X.setText(`${Ye}`)}));e.previewOverlay.clear()}let nt=4e3,rt=3e3,at=3e3,ot=3500,lt=1700,ht=3e3,ct=2e3,dt=3e3;class ut{constructor(e){this.energy=e,this.sprite}lightFire(e,t,i){console.log("Attempting to light fire..."),e.anims.exists("fireAnimConfig")?console.log("Fire animation already exists."):(console.log("Creating fire animation..."),e.anims.create({key:"fireAnimConfig",frames:e.anims.generateFrameNumbers("fire-blaze",{start:0,end:5}),frameRate:10,repeat:-1}));let s=e.add.sprite(t.x+32,t.y,"fire-blaze").setDepth(900).setScale(.75);console.log("Fire sprite created:",s),e.anims.exists("fireAnimConfig")?(console.log("Playing fire animation..."),s.play("fireAnimConfig")):console.error("ERROR: Animation 'fireAnimConfig' does not exist!"),i.add(s),s.tile=t,s.setInteractive(),s.on("pointerdown",(function(){"WATER"===Ge&&st(e,s.x,s.y,s)})),this.sprite=s}extinguishFire(){this.sprite.destroy()}startTimer(e,t,i,s,n){console.log("Timer activated!"),$e[e]=1,t.anims.exists("set-timer")||t.anims.create({key:"timerAnimConfig",frames:t.anims.generateFrameNumbers("set-timer"),frameRate:30,repeat:-1}),Ne.x=s,Ne.y=n,Ne.setVisible(!0),Ne.play("timerAnimConfig"),t.time.delayedCall(i,(()=>{Ne.setVisible(!1),t.anims.remove("timerAnimConfig"),$e[e]=0})),console.log(`Cooldown in StartTimer: ${$e[e]}`)}useHose(e,t,i,s){console.log("Team of firefighters activated!"),e.anims.create({key:"hoseAnimConfig",frames:e.anims.generateFrameNumbers("set-hose"),frameRate:40,repeat:-1});let n=e.add.sprite(t+40,i+32,"set-hose").setDepth(1e3).setScale(1.5,1.5);n.play("hoseAnimConfig"),e.time.delayedCall(nt,(()=>{n.destroy()}))}useFireExtinguisher(e,t,i,s){console.log("Fire extinguisher activated!"),e.anims.create({key:"extinguisherAnimConfig",frames:e.anims.generateFrameNumbers("set-extinguisher"),frameRate:10,repeat:-1});let n=e.add.sprite(t,i+32,"set-extinguisher").setDepth(1e3).setScale(.75,.75);n.play("extinguisherAnimConfig"),e.time.delayedCall(rt,(()=>{n.destroy()}))}useFiretruck(e,t,i,s){console.log("Fire truck activated!"),e.anims.create({key:"firetruckAnimConfig",frames:e.anims.generateFrameNumbers("set-firetruck"),frameRate:10,repeat:-1});let n=e.add.sprite(t+40,i+32,"set-firetruck").setDepth(1e3).setScale(1.3,1.3);n.play("firetruckAnimConfig"),e.time.delayedCall(at,(()=>{n.destroy()}))}useHelicopter(e,t,i,s){console.log("Helicopter activated!"),e.anims.create({key:"helicopterAnimConfig",frames:e.anims.generateFrameNumbers("set-helicopter"),frameRate:30,repeat:-1});let n=e.add.sprite(t,i-40,"set-helicopter").setDepth(1e3).setScale(1.5,1.5);n.play("helicopterAnimConfig"),e.time.delayedCall(ot,(()=>{n.destroy()}))}useAirtanker(e,t,i,s){console.log("Airtanker activated!"),e.anims.create({key:"airtankerAnimConfig",frames:e.anims.generateFrameNumbers("set-airtanker"),frameRate:30,repeat:-1});let n=e.add.sprite(t,i-40,"set-airtanker").setDepth(1e3).setScale(4.5,4.5);n.play("airtankerAnimConfig"),e.time.delayedCall(lt,(()=>{n.destroy()}))}useHotshotCrew(e,t,i){console.log("Hotshot Crew activated!"),e.anims.create({key:"hotshotAnimConfig",frames:e.anims.generateFrameNumbers("set-hotshot"),frameRate:30,repeat:-1});let s=e.add.sprite(t+40,i+28,"set-hotshot").setDepth(1e3).setScale(1.1,1.1);s.play("hotshotAnimConfig"),e.time.delayedCall(ht,(()=>{s.destroy()}))}useSmokejumpers(e,t,i,s){console.log("Smokejumpers activated!"),e.anims.create({key:"smokejumpersAnimConfig",frames:e.anims.generateFrameNumbers("set-smokejumpers"),frameRate:30,repeat:-1}),e.anims.create({key:"smokejumpersGroundAnimConfig",frames:e.anims.generateFrameNumbers("set-smokejumpers-dig"),frameRate:30,repeat:-1});let n=e.add.sprite(t,i-40,"set-smokejumpers").setDepth(1e3).setScale(2,2);n.play("smokejumpersAnimConfig"),e.time.delayedCall(ct,(()=>{n.destroy();let s=e.add.sprite(t,i,"set-smokejumpers-dig").setDepth(2).setScale(1,1);s.play("smokejumpersGroundAnimConfig"),e.time.delayedCall(dt,(()=>{s.destroy()}))}))}}var pt=i(223),gt=i(875),mt=i(594);const ft=(0,pt.Wp)({apiKey:"AIzaSyD1dJCegF2BZ5c01e4URiJrBPboHMqIhnI",authDomain:"wildfire-command.firebaseapp.com",projectId:"wildfire-command",storageBucket:"wildfire-command.firebasestorage.app",messagingSenderId:"824434588817",appId:"1:824434588817:web:c3276917d57b972c8a1330"}),xt=(0,gt.xI)(ft),St=(0,mt.aU)(ft);let yt=!0;class bt extends Phaser.Scene{constructor(){super("MapScene"),console.log("MapScene Constructor Called"),this.MAP_WIDTH=100,this.MAP_HEIGHT=100,this.TILE_SIZE=64,this.MIN_PARTITION_SIZE=5,this.CAMERA_SPEED=10,this.MIN_ZOOM=.25,this.MAX_ZOOM=2,this.UI_WIDTH=100,this.FIRE_SPREAD_INTERVAL=2e4,this.elapsedTime=0,this.lastFireSpreadTime=0,this.isFireSimRunning=!1,this.selectedTile=null,this.lastTileSnapshot=null,this.tileInfoUpdateInterval=500,this.lastTileInfoUpdate=0,this.currentZoom=1,this.isPanning=!1,this.panVector={x:0,y:0},this.score=0,this.disableZoom=!1}preload(){console.log("MapScene Preload Starting"),this.load.image("water","assets/64x64-Map-Tiles/water.png"),this.load.image("grass","assets/64x64-Map-Tiles/grass.png"),this.load.image("shrub","assets/64x64-Map-Tiles/Shrubs/shrubs-on-sand.png"),this.load.image("tree","assets/64x64-Map-Tiles/Trees/trees-on-light-dirt.png"),this.load.image("dirt-house","assets/64x64-Map-Tiles/dirt-house.png"),this.load.image("sand-house","assets/64x64-Map-Tiles/sand-house.png"),this.load.image("grass-house","assets/64x64-Map-Tiles/grass-house.png"),this.load.image("burned-grass","assets/64x64-Map-Tiles/Burned%20Tiles/burned-grass.png"),this.load.image("burned-shrub","assets/64x64-Map-Tiles/Burned%20Tiles/burned-shrubs-on-sand.png"),this.load.image("burned-tree","assets/64x64-Map-Tiles/Burned%20Tiles/burned-trees-on-light-dirt.png"),this.load.image("burned-dirt-house","assets/64x64-Map-Tiles/Burned%20Tiles/burned-dirt-house.png"),this.load.image("burned-sand-house","assets/64x64-Map-Tiles/Burned%20Tiles/burned-sand-house.png"),this.load.image("burned-grass-house","assets/64x64-Map-Tiles/Burned%20Tiles/burned-grass-house.png"),this.load.image("extinguished-grass","assets/64x64-Map-Tiles/Extinguished%20Tiles/grass.png"),this.load.image("extinguished-shrub","assets/64x64-Map-Tiles/Extinguished%20Tiles/shrub.png"),this.load.image("extinguished-tree","assets/64x64-Map-Tiles/Extinguished%20Tiles/tree.png"),this.load.image("extinguished-dirt-house","assets/64x64-Map-Tiles/Extinguished%20Tiles/dirt-house.png"),this.load.image("extinguished-sand-house","assets/64x64-Map-Tiles/Extinguished%20Tiles/sand-house.png"),this.load.image("extinguished-grass-house","assets/64x64-Map-Tiles/Extinguished%20Tiles/grass-house.png"),this.load.image("fire-break","assets/64x64-Map-Tiles/fire-break.png"),this.load.spritesheet("water-sheet","assets/64x64-Map-Tiles/splash-sheet.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("fire-blaze","assets/64x64-Map-Tiles/animated-flame.png",{frameWidth:64,frameHeight:64})}create(){console.log("MapScene Create Starting"),this.input.mouse.disableContextMenu(),this.initializeMap(),this.setupCameraControls(),this.scene.isActive("UIScene")||this.scene.launch("UIScene"),this.scene.get("UIScene").events.on("directionChosen",(e=>{if(null===e)return Ve=null,void console.log("Deployment canceled by user.");if(!Ve)return;const{scene:t,x:i,y:s,fireSprite:n}=Ve;Ve=null,st(t,i,s,n,e)})),this.input.on("pointerdown",this.handleTileClick,this),this.setupEventListeners(),this.events.on("extinguishFire",this.handleFireExtinguish,this),this.input.on("pointermove",this.updateDeploymentPreview,this),this.selectionMarker=this.add.graphics(),this.selectionMarker.lineStyle(3,65535,1),this.selectionMarker.strokeRect(0,0,this.TILE_SIZE,this.TILE_SIZE),this.selectionMarker.setVisible(!1),this.selectionMarker.setDepth(100),this.previewOverlay=this.add.graphics(),this.previewOverlay.setDepth(99),console.log("MapScene Create Finished")}setupEventListeners(){console.log("Setting up MapScene event listeners"),this.scene.get("UIScene").events.on("toggleFire",this.toggleFireSimulation,this),this.scene.get("UIScene").events.on("restartGame",this.initializeMap,this);const e=this.scene.get("UIScene");e.events.on("panStart",this.onPanStart,this),e.events.on("panStop",this.onPanStop,this)}setupCameraControls(){const e=this.cameras.main.width-this.UI_WIDTH,t=this.cameras.main.height,i=this.mapPixelWidth/this.mapPixelHeight,s=e/t;this.fitZoomLevel=i>s?Math.min(1,e/this.mapPixelWidth):Math.min(1,t/this.mapPixelHeight),this.MIN_ZOOM=Math.max(.8*this.fitZoomLevel,this.MIN_ZOOM),this.cameras.main.setBounds(0,0,this.mapPixelWidth,this.mapPixelHeight),this.cameras.main.setViewport(0,0,this.cameras.main.width,this.cameras.main.height),this.cameras.main.centerOn(this.mapPixelWidth/2,this.mapPixelHeight/2),this.currentZoom=Math.max(this.MIN_ZOOM,1),this.cameras.main.setZoom(this.currentZoom),this.input.on("wheel",((t,i,s,n)=>{if(!this.disableZoom&&t.x<e){const e=n>0?-.1:.1;this.currentZoom=Phaser.Math.Clamp(this.currentZoom+e,this.MIN_ZOOM,this.MAX_ZOOM),this.cameras.main.setZoom(this.currentZoom),this.events.emit("zoomChanged",this.currentZoom),this.centerMapIfNeeded()}})),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={up:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),down:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),left:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),right:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D)},this.zoomKeys={zoomIn:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.PLUS),zoomOut:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.MINUS)}}centerMapIfNeeded(){const e=this.mapPixelWidth*this.currentZoom,t=this.mapPixelHeight*this.currentZoom,i=this.cameras.main.width,s=this.cameras.main.height;if(e<i||t<s){const e=this.mapPixelWidth/2,t=this.mapPixelHeight/2;this.cameras.main.pan(e,t,300,"Power2")}}initializeMap(){const e=this.currentZoom||1;this.mapPixelWidth=this.MAP_WIDTH*this.TILE_SIZE,this.mapPixelHeight=this.MAP_HEIGHT*this.TILE_SIZE,this.currentSeed=Date.now()*Math.random(),console.log(`Map Seed: ${this.currentSeed}`),this.map=new Z(this.MAP_WIDTH,this.MAP_HEIGHT,this.MIN_PARTITION_SIZE,this.currentSeed),console.log("Map Partitions:"),this.map.bsp.getPartitions().forEach(((e,t)=>{console.log(`Partition ${t}: x=${e.x}, y=${e.y}, width=${e.width}, height=${e.height}`)})),this.weather=new Y(this.MAP_WIDTH,this.MAP_HEIGHT),this.fireSpread=new $(this.map,this.weather),this.elapsedTime=0,this.lastFireSpreadTime=0,this.isFireSimRunning=!0,this.currentZoom=Math.max(e,this.MIN_ZOOM),this.mapGroup&&!this.mapGroup.destroyed&&this.mapGroup.destroy(!0),this.mapGroup=this.add.group(),this.flameGroup?this.flameGroup.clear(!0,!0):this.flameGroup=this.add.group(),this.cameras&&this.cameras.main&&(this.cameras.main.setBounds(0,0,this.mapPixelWidth,this.mapPixelHeight),this.cameras.main.centerOn(this.mapPixelWidth/2,this.mapPixelHeight/2),this.cameras.main.setZoom(this.currentZoom)),this.renderMap(this.map,this.TILE_SIZE),this.time.delayedCall(500,(()=>{console.log("Delayed fire start after map initialization"),this.startFire()||(console.warn("Initial fire start failed, retrying..."),this.time.delayedCall(1e3,(()=>this.startFire()))),this.time.delayedCall(1e3,(()=>{this.simulateInitialSpread(4),this.isFireSimRunning=!1,this.events.emit("fireSimToggled",this.isFireSimRunning)}))})),this.events.emit("weatherUpdated",this.weather),this.events.emit("updateGameClock",this.elapsedTime),this.events.emit("mapSizeChanged",{width:this.MAP_WIDTH,height:this.MAP_HEIGHT,pixelWidth:this.mapPixelWidth,pixelHeight:this.mapPixelHeight}),this.scene.isActive("UIScene")&&(Ke(je()),X.setText(`${je()}`))}renderMap(e,t){e.grid.forEach(((e,i)=>{e.forEach(((e,s)=>{const n=this.textures.exists(e.terrain)?e.terrain:"defaultTerrain",r=this.add.sprite(s*t,i*t,n).setOrigin(0);e.sprite=r,r.setInteractive(),this.mapGroup.add(r)}))}))}handleTileClick(e){if(this.isPanning)return;const t=this.cameras.main.width-this.UI_WIDTH;if(e.x>t)return;const i=this.cameras.main.getWorldPoint(e.x,e.y),s=Math.floor(i.x/this.TILE_SIZE),n=Math.floor(i.y/this.TILE_SIZE);if(s<0||s>=this.map.width||n<0||n>=this.map.height)return;const r=this.map.getTile(s,n);if(r)if("deployment"!==ze)this.selectedTile=r,this.selectionMarker.setVisible(!0).setPosition(s*this.TILE_SIZE,n*this.TILE_SIZE),this.lastTileInfoSnapshot={...r},this.events.emit("tileInfo",{...r,screenX:e.x,screenY:e.y});else if("hotshot-crew"===We||"hotshotcrew"===We)st(this,s*this.TILE_SIZE,n*this.TILE_SIZE,null);else{const e=r.fireSprite;if(!e)return;st(this,e.x,e.y,e)}}startFire(){if(console.log("Starting fire initialization..."),!this.map||!this.map.grid||0===this.map.grid.length)return console.error("Map not properly initialized when starting fire!"),void this.time.delayedCall(500,(()=>this.startFire()));let e,t,i,s=0,n=!1;for(console.log("Searching for flammable tile...");!n&&s<200;){if(e=Math.floor(Math.random()*this.map.width),t=Math.floor(Math.random()*this.map.height),t>=0&&t<this.map.grid.length&&e>=0&&e<this.map.grid[t].length)if(i=this.map.grid[t][e],i&&void 0!==i.flammability){if(i.flammability>0){n=!0,console.log(`Found flammable tile at (${e}, ${t}) after ${s} attempts`);break}}else console.warn("Found invalid tile at",e,t);s++}if(!n){console.log("Random search failed, trying systematic search...");for(let s=0;s<this.map.height;s++){for(let r=0;r<this.map.width;r++)if(s<this.map.grid.length&&r<this.map.grid[s].length){const a=this.map.grid[s][r];if(a&&a.terrain&&("tree"===a.terrain||"shrub"===a.terrain||"grass"===a.terrain||"dirt_house"===a.terrain||"sand_house"===a.terrain||"grass_house"===a.terrain)){e=r,t=s,i=a,0===i.flammability&&(console.log(`Forcing tile at (${r}, ${s}) to be flammable`),i.flammability=1,i.fuel=10),n=!0;break}}if(n)break}}if(!n||!i)return console.error("CRITICAL: Could not find any flammable tile after exhaustive search"),console.log("Map data:",this.map),void this.time.delayedCall(1e3,(()=>{console.log("Attempting fire start again after delay"),this.startFire()}));if(console.log(`Setting fire at (${e}, ${t}) with terrain: ${i.terrain}`),i.burnStatus="burning",i.sprite)try{let e=new ut(3);e.lightFire(this,i.sprite,this.flameGroup),i.fireS=e,console.log("Fire sprite added successfully")}catch(e){console.error("Failed to add fire sprite:",e)}else console.warn("Tile has no sprite to attach fire effect to");try{this.cameras.main.pan(e*this.TILE_SIZE+this.TILE_SIZE/2,t*this.TILE_SIZE+this.TILE_SIZE/2,1e3,"Power2"),console.log("Camera panned to fire location")}catch(e){console.error("Failed to pan camera:",e)}return!0}simulateInitialSpread(e=4){let t=[];for(let e=0;e<this.map.height;e++)for(let i=0;i<this.map.width;i++)"burning"===this.map.grid[e][i].burnStatus&&t.push({x:i,y:e});let i=new Set(t.map((e=>`${e.x},${e.y}`)));for(let s=0;s<e;s++){let e=[];t.forEach((({x:t,y:s})=>{this.fireSpread.getNeighbors(t,s).forEach((({x:t,y:s})=>{const n=this.map.grid[s][t],r=`${t},${s}`;if(!i.has(r)&&this.fireSpread.canIgnite(n)){if(n.burnStatus="burning",!n.fireS&&n.sprite){const e=new ut(3);e.lightFire(this,n.sprite,this.flameGroup),n.fireS=e}e.push({x:t,y:s}),i.add(r)}}))})),t=e}console.log("Simulated initial non-burning fire burst.")}updateFireSpread(){if(0===this.fireSpread.simulateFireStep())return console.log("You win!"),this.isFireSimRunning=!1,this.events.emit("gameWon"),this.events.emit("fireSimToggled",!1),void this.sendScoreToDB();this.map.grid.forEach((e=>e.forEach((e=>{if("burning"===e.burnStatus&&!e.fireS){const t=new ut(3);t.lightFire(this,e.sprite,this.flameGroup),e.fireS=t}}))))}updateDeploymentPreview(e){if("deployment"!==ze||!We)return void this.previewOverlay.clear();const t=this.cameras.main.getWorldPoint(e.x,e.y),i=Math.floor(t.x/this.TILE_SIZE),s=Math.floor(t.y/this.TILE_SIZE);this.previewOverlay.clear();const n=this.dropDirection||"horizontal";if("hotshot-crew"===We){this.previewOverlay.lineStyle(2,16766720,1);for(let e=-2;e<=2;e++){const t="vertical"===n?i+e:i,r="horizontal"===n?s+e:s;t>=0&&t<this.map.width&&r>=0&&r<this.map.height&&this.previewOverlay.strokeRect(t*this.TILE_SIZE,r*this.TILE_SIZE,this.TILE_SIZE,this.TILE_SIZE)}}"airtanker"===We&&(this.previewOverlay.lineStyle(2,65535,1),this.previewOverlay.strokeCircle(i*this.TILE_SIZE+this.TILE_SIZE/2,s*this.TILE_SIZE+this.TILE_SIZE/2,2.5*this.TILE_SIZE))}toggleFireSimulation(){console.log("Toggle fire simulation called"),this.isFireSimRunning=!this.isFireSimRunning,console.warn("Fire Simulation "+(this.isFireSimRunning?"Started":"Stopped")),yt=!this.isFireSimRunning,this.events.emit("fireSimToggled",this.isFireSimRunning)}update(e,t){if(this.isFireSimRunning){this.elapsedTime+=t/1e3,this.events.emit("updateGameClock",this.elapsedTime);const e=this.elapsedTime-this.lastFireSpreadTime,i=this.FIRE_SPREAD_INTERVAL/1e3,s=e/i*100;this.scene.get("UIScene").updateFireProgress(s),e>=i&&(this.weather.updateOverTime(1e3*i),this.events.emit("weatherUpdated",this.weather),this.lastFireSpreadTime=this.elapsedTime,this.updateFireSpread())}if(this.scene.isActive("LoginScene")||this.scene.isActive("SignupScene")||this.handleCameraControls(t),this.flameGroup&&this.flameGroup.getChildren().length>0&&this.flameGroup.getChildren().forEach((e=>{e.setScale(1/this.currentZoom)})),this.selectedTile&&(this.lastTileInfoUpdate+=t,this.lastTileInfoUpdate>=this.tileInfoUpdateInterval)){this.lastTileInfoUpdate=0;const e={fuel:this.selectedTile.fuel,burnStatus:this.selectedTile.burnStatus,terrain:this.selectedTile.terrain};JSON.stringify(e)!==JSON.stringify(this.lastTileSnapshot)&&(this.events.emit("tileInfo",{...this.selectedTile,screenX:this.input.activePointer.x,screenY:this.input.activePointer.y}),this.lastTileSnapshot={...e})}}onPanStart(e){this.panVector=e}onPanStop(){this.panVector={x:0,y:0}}handleCameraControls(e){const t=this.CAMERA_SPEED/this.currentZoom;let i=(this.cursors.left.isDown||this.wasd.left.isDown?-t:0)+(this.cursors.right.isDown||this.wasd.right.isDown?t:0),s=(this.cursors.up.isDown||this.wasd.up.isDown?-t:0)+(this.cursors.down.isDown||this.wasd.down.isDown?t:0);0===i&&0===s||(this.cameras.main.scrollX+=i,this.cameras.main.scrollY+=s);let n=!1;this.zoomKeys.zoomIn.isDown?(this.currentZoom=Phaser.Math.Clamp(this.currentZoom+.01,this.MIN_ZOOM,this.MAX_ZOOM),this.cameras.main.setZoom(this.currentZoom),n=!0):this.zoomKeys.zoomOut.isDown&&(this.currentZoom=Phaser.Math.Clamp(this.currentZoom-.01,this.MIN_ZOOM,this.MAX_ZOOM),this.cameras.main.setZoom(this.currentZoom),n=!0),i+=this.panVector.x*t,s+=this.panVector.y*t,(i||s)&&(this.cameras.main.scrollX+=i,this.cameras.main.scrollY+=s),n&&(this.events.emit("zoomChanged",this.currentZoom),this.centerMapIfNeeded())}handleFireExtinguish(e){let t=Math.floor(e.x/this.TILE_SIZE),i=Math.floor(e.y/this.TILE_SIZE);if(t>=0&&t<this.map.width&&i>=0&&i<this.map.height){let e=this.map.grid[i][t];e&&(e.burnStatus="extinguished",this.score+=1,this.events.emit("scoreUpdated",this.score),console.log("Score: ",this.score),"grass"===e.terrain?e.terrain="extinguished-grass":e.terrain.includes("shrub")||"shrub"===e.terrain?e.terrain="extinguished-shrub":e.terrain.includes("tree")||"tree"===e.terrain?e.terrain="extinguished-tree":e.terrain.includes("dirt-house")||"dirt-house"===e.terrain?e.terrain="extinguished-dirt-house":e.terrain.includes("sand-house")||"sand-house"===e.terrain?e.terrain="extinguished-sand-house":(e.terrain.includes("grass-house")||"grass-house"===e.terrain)&&(e.terrain="extinguished-grass-house"),this.fireSpread.updateSprite(t,i),e.fireS&&(e.fireS.extinguishFire(),e.fireS=null))}}sendScoreToDB(){const e=this.score;this.saveUserScore(e)}async saveUserScore(e){const t=xt.currentUser;if(t){const i=(0,mt.H9)((0,mt.rJ)(St,"users",t.uid,"scores"));try{await(0,mt.BN)(i,{score:e}),console.log("Score saved successfully")}catch(e){console.error("Error saving score",e)}}else console.log("User not signed in")}async getHighestScore(){const e=xt.currentUser;if(!e)return console.log("User not signed in"),null;{const t=(0,mt.rJ)(St,"users",e.uid,"scores"),i=(0,mt.P)(t,(0,mt.My)("score","desc"),(0,mt.AB)(1));try{const e=await(0,mt.GG)(i);if(e.empty)return console.log("No scores found"),null;{const t=e.docs[0].data().score;return console.log(t),t}}catch(e){return console.error("Error fetching scores",e),null}}}async getTopNScores(e){const t=xt.currentUser;if(!t)return console.log("User not signed in"),[];const i=(0,mt.rJ)(St,"users",t.uid,"scores"),s=(0,mt.P)(i,(0,mt.My)("score","desc"),(0,mt.AB)(e));try{const t=await(0,mt.GG)(s);if(t.empty)return console.log("No scores found"),[];const i=t.docs.map((e=>e.data().score));return console.log(`Top ${e} scores:`,i),i}catch(e){return console.error("Error fetching top scores",e),[]}}async getGlobalTopNScores(e){const t=(0,mt.Cs)(St,"scores"),i=(0,mt.P)(t,(0,mt.My)("score","desc"),(0,mt.AB)(e));try{const e=await(0,mt.GG)(i);return e.empty?(console.log("No global scores found"),[]):await Promise.all(e.docs.map((async e=>{const[,t]=e.ref.path.split("/"),i=await(0,mt.x7)((0,mt.H9)(St,"users",t));return{userId:t,displayName:i.exists()?i.data().displayName:t,score:e.data().score}})))}catch(e){return console.error("Error fetching global top scores:",e),[]}}}class wt{constructor(e,t={}){this.scene=e,this.options={width:t.width||400,height:t.height||500,backgroundColor:t.backgroundColor||2962486,buttonColor:t.buttonColor||5592405,buttonHoverColor:t.buttonHoverColor||7829367,activeColor:t.activeColor||2263842,depth:t.depth||1e3,onSettingsApplied:t.onSettingsApplied||null},this.container=null,this.accessibilityToggles=[],this.isVisible=!1,this.init()}init(){this.container=this.scene.add.container(0,0).setDepth(this.options.depth).setVisible(!1);const e=this.scene.add.rectangle(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2,this.options.width,this.options.height,this.options.backgroundColor,.95).setScrollFactor(0),t=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2-220,"Accessibility Options",{fontFamily:'"Press Start 2P"',fontSize:"20px",color:"#ffffff",align:"center"}).setOrigin(.5).setScrollFactor(0),i=r(this.scene,{x:this.scene.cameras.main.width/2+170,y:this.scene.cameras.main.height/2-220,width:30,height:30,backgroundColor:9109504,hoverColor:10824234,text:"X",fontSize:"16px",onClick:()=>this.hide()});this.container.add([e,t,i.button,i.buttonText]);const s=this.scene.cameras.main.height/2-150;[{text:"High Contrast Mode",key:"highContrast"},{text:"Larger Text",key:"largerText"},{text:"Reduced Motion",key:"reducedMotion"},{text:"Screen Reader Support",key:"screenReader"},{text:"Colorblind Mode",key:"colorblind",isSelector:!0}].forEach(((e,t)=>{const i=s+60*t,n=this.scene.add.text(this.scene.cameras.main.width/2-150,i,e.text,{fontFamily:'"Press Start 2P"',fontSize:"14px",color:"#ffffff"}).setScrollFactor(0);if(this.container.add(n),e.isSelector){const t=r(this.scene,{x:this.scene.cameras.main.width/2+100,y:i,width:150,height:30,backgroundColor:this.options.buttonColor,hoverColor:this.options.buttonHoverColor,text:"Deuteranopia",fontSize:"10px",onClick:()=>this.cycleColorblindMode(t)});this.container.add([t.button,t.buttonText]),this.accessibilityToggles.push({key:e.key,element:t,value:"deuteranopia"})}else{const t=this.scene.add.rectangle(this.scene.cameras.main.width/2+100,i,50,26,this.options.buttonColor).setScrollFactor(0),s=this.scene.add.circle(this.scene.cameras.main.width/2+80,i,10,16777215).setScrollFactor(0);t.setInteractive().on("pointerdown",(()=>{const i=t.fillColor===this.options.activeColor;t.setFillStyle(i?this.options.buttonColor:this.options.activeColor),s.x=i?this.scene.cameras.main.width/2+80:this.scene.cameras.main.width/2+120,this.accessibilityToggles.find((t=>t.key===e.key)).value=!i})),this.container.add([t,s]),this.accessibilityToggles.push({key:e.key,element:{bg:t,circle:s},value:!1})}}));const n=r(this.scene,{x:this.scene.cameras.main.width/2,y:this.scene.cameras.main.height/2+200,width:150,height:40,backgroundColor:2263842,hoverColor:3050327,text:"Apply",fontSize:"16px",onClick:()=>this.applySettings()});this.container.add([n.button,n.buttonText]),this.loadSavedSettings()}loadSavedSettings(){try{const e=JSON.parse(localStorage.getItem("accessibilitySettings")||"{}");Object.entries(e).forEach((([e,t])=>{const i=this.accessibilityToggles.find((t=>t.key===e));if(i)if("colorblind"===e){const e=["Deuteranopia","Protanopia","Tritanopia","None"].find((e=>e.toLowerCase()===t))||"None";i.element.buttonText.setText(e),i.value=t}else i.element.bg.setFillStyle(t?this.options.activeColor:this.options.buttonColor),i.element.circle.x=t?this.scene.cameras.main.width/2+120:this.scene.cameras.main.width/2+80,i.value=t}))}catch(e){console.error("Error loading accessibility settings:",e)}}cycleColorblindMode(e){const t=["Deuteranopia","Protanopia","Tritanopia","None"],i=this.accessibilityToggles.find((e=>"colorblind"===e.key)),s=(t.findIndex((e=>e.toLowerCase()===i.value))+1)%t.length,n=t[s].toLowerCase();e.buttonText.setText(t[s]),i.value=n}applySettings(){try{const e={};this.accessibilityToggles.forEach((t=>{e[t.key]=t.value})),localStorage.setItem("accessibilitySettings",JSON.stringify(e))}catch(e){console.error("Error saving accessibility settings:",e)}this.accessibilityToggles.forEach((e=>{this.scene.events&&this.scene.events.emit(`set${e.key.charAt(0).toUpperCase()+e.key.slice(1)}`,e.value)})),this.options.onSettingsApplied&&this.options.onSettingsApplied(this.accessibilityToggles.reduce(((e,t)=>(e[t.key]=t.value,e)),{})),this.showConfirmation()}showConfirmation(){const e=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2+150,"Settings Applied!",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#00ff00",align:"center"}).setOrigin(.5).setScrollFactor(0);this.container.add(e),this.scene.time.delayedCall(2e3,(()=>{e.destroy()}))}show(){this.container.setVisible(!0),this.isVisible=!0}hide(){this.container.setVisible(!1),this.isVisible=!1}toggle(){this.isVisible?this.hide():this.show()}getSettings(){return this.accessibilityToggles.reduce(((e,t)=>(e[t.key]=t.value,e)),{})}}class Ft{constructor(e,t={}){this.scene=e,this.options={x:t.x||40,y:t.y||30,width:t.width||250,backgroundColor:t.backgroundColor||2962486,buttonColor:t.buttonColor||5592405,buttonHoverColor:t.buttonHoverColor||7829367,iconColor:t.iconColor||16777215,depth:t.depth||1e3,openDirection:t.openDirection||"left",menuItems:t.menuItems||[{text:"Profile",key:"profile"},{text:"Leaderboard",key:"leaderboard"},{text:"Login/Logout",key:"login"},{text:"Main Menu",key:"menu"}]},this.isOpen=!1,this.container=null,this.button=null,this.menuPanel=null,this.menuItems=[],this.accessibilityPanel=null,this.init()}init(){this.container=this.scene.add.container(0,0).setDepth(this.options.depth),this.createMenuButton(),this.createMenuPanel(),this.createAccessibilityPanel()}createMenuButton(){const e=this.scene.add.rectangle(this.options.x,this.options.y,40,40,this.options.buttonColor,.7).setInteractive().setScrollFactor(0).on("pointerover",(()=>{e.setFillStyle(this.options.buttonHoverColor,.8)})).on("pointerout",(()=>{e.setFillStyle(this.options.buttonColor,.7)})).on("pointerdown",(()=>{this.toggleMenu()})),t=this.options.x-10,i=this.options.y-8;this.iconLines=[this.scene.add.rectangle(t,i,20,3,this.options.iconColor).setScrollFactor(0),this.scene.add.rectangle(t,i+6,20,3,this.options.iconColor).setScrollFactor(0),this.scene.add.rectangle(t,i+12,20,3,this.options.iconColor).setScrollFactor(0)],this.container.add([e,...this.iconLines]),this.button=e}createMenuPanel(){this.menuPanel=this.scene.add.rectangle(-this.options.width/2,this.scene.cameras.main.height/2,this.options.width,this.scene.cameras.main.height,this.options.backgroundColor,.9).setScrollFactor(0).setVisible(!1),this.container.add(this.menuPanel),this.createMenuItems()}createMenuItems(){this.options.menuItems.forEach(((e,t)=>{const i=100+50*t,s=r(this.scene,{x:this.options.width/2,y:i,width:this.options.width-40,height:40,backgroundColor:this.options.buttonColor,hoverColor:this.options.buttonHoverColor,text:e.text,fontSize:"16px",onClick:()=>this.handleMenuItemClick(e.key)});s.button.setVisible(!1),s.buttonText.setVisible(!1),this.menuItems.push(s),this.container.add([s.button,s.buttonText])}))}createAccessibilityPanel(){this.accessibilityPanel=new wt(this.scene,{depth:this.options.depth+1,onSettingsApplied:e=>{console.log("Accessibility settings applied:",e)}})}handleMenuItemClick(e){switch(console.log(`Menu item clicked: ${e}`),e){case"accessibility":this.showAccessibilityPanel();break;case"profile":this.scene.scene&&this.scene.scene.launch("ProfileScene"),this.toggleMenu();break;case"leaderboard":this.scene.scene&&this.scene.scene.launch("LeaderboardScene"),this.toggleMenu();break;case"login":const e=window.firebase?.auth?.();e&&e.currentUser?this.showLogoutConfirmation():this.scene.scene&&this.scene.scene.launch("LoginScene"),this.toggleMenu();break;case"menu":window.location.reload(),this.toggleMenu();break;default:this.toggleMenu()}}showAccessibilityPanel(){this.accessibilityPanel.show(),this.toggleMenu()}hideAccessibilityPanel(){this.accessibilityPanel.hide()}showLogoutConfirmation(){const e=this.scene.add.container(0,0).setDepth(this.options.depth+10),t=this.scene.add.rectangle(0,0,this.scene.cameras.main.width,this.scene.cameras.main.height,0,.7).setOrigin(0,0),i=this.scene.add.rectangle(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2,400,250,2962486,.95).setStrokeStyle(3,5592405),s=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2-80,"Confirm Logout",{fontFamily:'"Press Start 2P"',fontSize:"20px",color:"#ffffff",align:"center"}).setOrigin(.5),n=this.scene.add.text(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2-30,"Are you sure you want to logout?",{fontFamily:'"Press Start 2P"',fontSize:"14px",color:"#ffffff",align:"center",wordWrap:{width:350}}).setOrigin(.5),a=r(this.scene,{x:this.scene.cameras.main.width/2-100,y:this.scene.cameras.main.height/2+50,width:140,height:40,backgroundColor:9109504,hoverColor:10824234,text:"Logout",fontSize:"14px",onClick:()=>{const t=window.firebase?.auth?.();t&&t.signOut().then((()=>{console.log("User signed out"),this.scene.scene.start("LoginScene")})).catch((e=>{console.error("Error signing out:",e)})),e.destroy()}}),o=r(this.scene,{x:this.scene.cameras.main.width/2+100,y:this.scene.cameras.main.height/2+50,width:140,height:40,backgroundColor:5592405,hoverColor:7829367,text:"Cancel",fontSize:"14px",onClick:()=>{e.destroy()}});e.add([t,i,s,n,a.button,a.buttonText,o.button,o.buttonText]),t.setInteractive().on("pointerdown",(()=>{e.destroy()}))}toggleMenu(){this.isOpen=!this.isOpen,this.menuPanel.setVisible(this.isOpen),this.menuItems.forEach((e=>{e.button.setVisible(this.isOpen),e.buttonText.setVisible(this.isOpen)})),this.animateIcon(),this.animateMenuPanel()}animateIcon(){this.isOpen?(this.scene.tweens.add({targets:this.iconLines[0],y:this.options.y,rotation:Math.PI/4,duration:300,ease:"Power2"}),this.scene.tweens.add({targets:this.iconLines[1],alpha:0,duration:300,ease:"Power2"}),this.scene.tweens.add({targets:this.iconLines[2],y:this.options.y,rotation:-Math.PI/4,duration:300,ease:"Power2"})):(this.scene.tweens.add({targets:this.iconLines[0],y:this.options.y-8,rotation:0,duration:300,ease:"Power2"}),this.scene.tweens.add({targets:this.iconLines[1],alpha:1,duration:300,ease:"Power2"}),this.scene.tweens.add({targets:this.iconLines[2],y:this.options.y+4,rotation:0,duration:300,ease:"Power2"}))}animateMenuPanel(){this.isOpen?this.scene.tweens.add({targets:this.menuPanel,x:this.options.width/2,duration:300,ease:"Power2"}):this.scene.tweens.add({targets:this.menuPanel,x:-this.options.width/2,duration:300,ease:"Power2"})}}var Tt=i(371);"undefined"!=typeof window&&(window.WebFont=Tt);class It extends s.Loader.File{constructor(e,t,i="google"){super(e,{type:"webfont",key:t.toString()}),this.fontNames=Array.isArray(t)?t:[t],this.service=i}load(){const e={active:()=>{this.loader.nextFile(this,!0)}};if("google"!==this.service)throw new Error("Unsupported font service: "+this.service);e.google={families:this.fontNames},Tt.load(e)}}class Ct extends Phaser.Scene{constructor(){super("UIScene"),this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.UI_SIDEBAR_WIDTH=100,this.GAME_AREA_WIDTH=this.SCREEN_WIDTH-this.UI_SIDEBAR_WIDTH,this.TITLE_X=40,this.TITLE_Y=40,this.LOGIN_BUTTON_X=40,this.LOGIN_BUTTON_Y=560,this.RESTART_BUTTON_X=90,this.RESTART_BUTTON_Y=50,this.GAME_CLOCK_X=300,this.GAME_CLOCK_Y=10,this.WEATHER_X=540,this.WEATHER_Y=40,this.WEATHER_PANEL_X=360,this.WEATHER_PANEL_Y=200,this.FIRE_BUTTON_X=140,this.FIRE_BUTTON_Y=50,this.TILE_INFO_X=100,this.TILE_INFO_Y=80,this.ZOOM_PERCENT_TEXT_X=176,this.ZOOM_PERCENT_TEXT_Y=550,this.WIND_GAUGE_X=90,this.WIND_GAUGE_Y=30,this.WIND_GAUGE_WIDTH=140,this.WIND_GAUGE_HEIGHT=16,this.BUTTON_COLORS={DEFAULT:"#A0522D",HOVER:"#8B4513",FIRE_BUTTON:"#8B0000"},this.TILE_INFO_DISPLAY_TIME=3e3}preload(){var e;e=this,console.log("preloadHUD called"),e.load.image("coins","assets/coins.png"),e.load.image("open-shop","assets/UI/open-shop.png"),e.load.image("shop","assets/UI/shop.png"),e.load.image("add-to-cart","assets/UI/add-to-cart.png"),e.load.image("remove-from-cart","assets/UI/remove-from-cart.png"),e.load.image("toggle-add-to-cart","assets/UI/toggle-add-to-cart.png"),e.load.image("remove-button","assets/UI/remove-button.png"),e.load.image("purchase","assets/UI/purchase.png"),e.load.image("close","assets/UI/close.png"),e.load.image("no-funds","assets/UI/no-funds.png"),e.load.image("price-tag","assets/UI/price-tag.png"),e.load.image("hose-tooltip","assets/resources/tooltips/fire-hose.png"),e.load.image("extinguisher-tooltip","assets/resources/tooltips/fire-extinguisher.png"),e.load.image("helicopter-tooltip","assets/resources/tooltips/helicopter.png"),e.load.image("firetruck-tooltip","assets/resources/tooltips/firetruck.png"),e.load.image("airtanker-tooltip","assets/resources/tooltips/airtanker.png"),e.load.image("hotshot-crew-tooltip","assets/resources/tooltips/hotshot-crew.png"),e.load.image("smokejumper-tooltip","assets/resources/tooltips/smokejumpers.png"),e.load.image("hose","assets/resources/fire-hose.png"),e.load.image("extinguisher","assets/resources/fire-extinguisher.png"),e.load.image("helicopter","assets/resources/helicopter.png"),e.load.image("firetruck","assets/resources/firetruck.png"),e.load.image("airtanker","assets/resources/airtanker.png"),e.load.image("hotshot-crew","assets/resources/hotshot-crew.png"),e.load.image("smokejumper","assets/resources/smokejumpers.png"),e.load.image("active-hose","assets/resources/activated/fire-hose.png"),e.load.image("active-extinguisher","assets/resources/activated/fire-extinguisher.png"),e.load.image("active-helicopter","assets/resources/activated/helicopter.png"),e.load.image("active-firetruck","assets/resources/activated/firetruck.png"),e.load.image("active-airtanker","assets/resources/activated/airtanker.png"),e.load.image("active-hotshot-crew","assets/resources/activated/hotshot-crew.png"),e.load.image("active-smokejumper","assets/resources/activated/smokejumpers.png"),e.load.image("out-of-hoses","assets/resources/notifications/fire-hose.png"),e.load.image("out-of-fire-extinguishers","assets/resources/notifications/fire-extinguisher.png"),e.load.image("out-of-helicopters","assets/resources/notifications/helicopter.png"),e.load.image("out-of-firetrucks","assets/resources/notifications/firetruck.png"),e.load.image("out-of-airtankers","assets/resources/notifications/airtankers.png"),e.load.image("out-of-hotshots","assets/resources/notifications/hotshot-crews.png"),e.load.image("out-of-smokejumpers","assets/resources/notifications/smokejumpers.png"),e.load.image("cooldown","assets/resources/notifications/cooldown.png"),e.load.spritesheet("set-timer","assets/timer.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-hose","assets/64x64-Map-Tiles/Deployable%20Resources/fire-hose.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-extinguisher","assets/64x64-Map-Tiles/Deployable%20Resources/extinguisher.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-firetruck","assets//64x64-Map-Tiles/Deployable%20Resources/firetruck.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-helicopter","assets//64x64-Map-Tiles/Deployable%20Resources/helicopter.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-airtanker","assets//64x64-Map-Tiles/Deployable%20Resources/airtanker.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-hotshot","assets//64x64-Map-Tiles/Deployable%20Resources/hotshot-crew.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-smokejumpers","assets//64x64-Map-Tiles/Deployable%20Resources/smokejumpers.png",{frameWidth:64,frameHeight:64}),e.load.spritesheet("set-smokejumpers-dig","assets//64x64-Map-Tiles/Deployable%20Resources/trench-digger.png",{frameWidth:64,frameHeight:64}),this.load.addFile(new It(this.load,"Press Start 2P")),this.load.image("weather_title_closed","assets/UI/weather_title_closed.png"),this.load.image("weather_title_opened","assets/UI/weather_title_opened.png"),this.load.image("humidity_full","assets/UI/humidity_full.png"),this.load.image("humidity_half","assets/UI/humidity_half.png"),this.load.image("humidity_low","assets/UI/humidity_low.png"),this.load.image("wind_1arrow","assets/UI/wind_1arrow.png"),this.load.image("wind_2arrow","assets/UI/wind_2arrow.png"),this.load.image("wind_3arrow","assets/UI/wind_3arrow.png"),this.load.image("wind-arrow","assets/UI/up.png"),this.load.image("up","assets/UI/up.png"),this.load.image("right","assets/UI/right.png"),this.load.image("down","assets/UI/down.png"),this.load.image("left","assets/UI/left.png"),this.load.image("weather_panel","assets/UI/weather_panel.png"),this.load.image("Title","assets/UI/Title.png"),this.load.image("toggle_ui_off","assets/UI/toggle_ui_off.png"),this.load.image("toggle_ui_on","assets/UI/toggle_ui_on.png")}generateFuelText(e,t){return`${e.toFixed(1)}/${t.toFixed(1)}`}create(){console.log("UIScene Created"),this.uiContainer=this.add.container(0,0),this.topBarContainer=this.add.container(0,0),this.bottomBarContainer=this.add.container(0,this.scale.height-60),this.uiToggleButtonContainer=this.add.container(0,0).setScrollFactor(0),this.createUIElements(),this.pauseText=this.add.text(this.scale.width/2,this.cameras.main.height/2,"Game Paused",{fontFamily:'"Press Start 2P"',fontSize:"24px",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:{x:20,y:10},align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(1e3).setVisible(!1),this.uiContainer.add(this.pauseText);let e=this.add.rectangle(this.scale.width/2,30,this.cameras.main.width,60,2962486);e.setScrollFactor(0),e.setDepth(5),this.uiContainer.add(e),this.topBarContainer.setDepth(10),this.uiContainer.add(this.topBarContainer),this.hamburgerMenu=new Ft(this,{x:40,y:30,depth:1e3,openDirection:"left"}),this.accessibilityPanel=new wt(this,{depth:1001,onSettingsApplied:e=>{console.log("Accessibility settings applied:",e)}});const t=r(this,{x:120,y:30,width:80,height:30,backgroundColor:9109504,hoverColor:10824234,text:"Restart",fontSize:"10px",onClick:()=>{console.log("Restart clicked"),this.events.emit("restartGame");const e=this.scene.get("MapScene");e&&"function"==typeof e.sendScoreToDB&&e.sendScoreToDB()}});this.topBarContainer.add([t.button,t.buttonText]),this.fireButton=r(this,{x:200,y:30,width:80,height:30,backgroundColor:2263842,hoverColor:3050327,text:"Start",fontSize:"10px",onClick:()=>{console.log("Start Fire clicked"),this.events.emit("toggleFire")}}),this.topBarContainer.add([this.fireButton.button,this.fireButton.buttonText]),this.gameClockText.setPosition(400,15,"Time: 00:00"),this.gameClockText.setOrigin(.5,0),this.gameClockText.setStyle({fontFamily:'"Press Start 2P"',fontSize:"10px",fontStyle:"normal",color:"#FFFFFF",align:"center",padding:{x:5,y:2}}),this.topBarContainer.add(this.gameClockText);const i=this.add.rectangle(this.scale.width/2,this.scale.height-30,this.scale.width,60,2962486).setScrollFactor(0);var s;this.bottomBarContainer.add(i),this.createZoomControls(),this.sys.game.device.os.desktop?console.log("desktop"):this.createNavigationCompass(),s=this,console.log("createHUD called"),j=s.add.rectangle(s.game.scale.width-55,300,110,600,2962486),j.setDepth(-1),console.log("Sidebar created"),se=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"cooldown").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),ne=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-hoses").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),re=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-fire-extinguishers").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),ae=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-helicopters").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),oe=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-firetrucks").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),le=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-airtankers").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),he=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-hotshots").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),ce=s.add.sprite(s.cameras.main.width/2,s.cameras.main.height/2,"out-of-smokejumpers").setScale(1).setDepth(500).setOrigin(.5,.5).setVisible(!1),s.input.setDefaultCursor("url(assets/cursors/glove.png), pointer"),Ue=s.add.sprite(550,560,"coins").setOrigin(.5,.5).setDepth(50).setScale(.23),X=s.add.text(610,560,"0",{fontFamily:'"Press Start 2P"',fontSize:"16px",fontStyle:"normal",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(50),Le=s.add.sprite(s.game.scale.width-660,560,"open-shop").setOrigin(.5,.5).setDepth(50).setScale(.23),Le.setInteractive({useHandCursor:!0}).on("pointerover",(()=>{Le.setAlpha(.8),Le.fillColor=4473924})).on("pointerout",(()=>{Le.setAlpha(1)})),function(e){let t=e.add.rectangle(e.cameras.main.width/2,e.cameras.main.height/2,500,450,2962486,.95).setDepth(500).setOrigin(.5,.5).setVisible(!1).setStrokeStyle(3,16777215),i=e.add.text(e.cameras.main.width/2,e.cameras.main.height/2-200,"SHOP",{fontFamily:'"Press Start 2P"',fontSize:"24px",color:"#FFFFFF",align:"center"}).setOrigin(.5,.5).setDepth(501).setVisible(!1),s=e.add.rectangle(e.cameras.main.width/2+230,e.cameras.main.height/2-200,30,30,9109504).setDepth(501).setOrigin(.5,.5).setVisible(!1),n=e.add.text(e.cameras.main.width/2+230,e.cameras.main.height/2-200,"X",{fontFamily:'"Press Start 2P"',fontSize:"18px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(502).setVisible(!1),r=[],a=[],o=[],l=[],h=[];[{asset:"hose",price:150,y:210},{asset:"extinguisher",price:25,y:210},{asset:"helicopter",price:300,y:277},{asset:"firetruck",price:250,y:277},{asset:"airtanker",price:250,y:347},{asset:"hotshot-crew",price:700,y:347},{asset:"smokejumper",price:250,y:417}].forEach(((t,i)=>{const s=i%2,n=Math.floor(i/2),c=e.cameras.main.width/2+(0===s?-110:110),d=e.cameras.main.height/2-120+80*n,u=e.add.rectangle(c,d,180,60,3355443).setDepth(501).setOrigin(.5).setVisible(!1),p=e.add.image(c-70,d,t.asset).setDepth(502).setScale(.6).setOrigin(.5).setVisible(!1),g=e.add.text(c,d-20,`$${t.price}`,{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFD700"}).setOrigin(.5,.5).setDepth(502).setVisible(!1),m=e.add.text(c,d,"0",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(502).setVisible(!1),f=e.add.rectangle(c-30,d,25,25,9109504).setDepth(502).setOrigin(.5).setVisible(!1).setInteractive(),x=e.add.text(c-30,d,"-",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(503).setVisible(!1),S=e.add.rectangle(c+30,d,25,25,2263842).setDepth(502).setOrigin(.5).setVisible(!1).setInteractive(),y=e.add.text(c+30,d,"+",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(503).setVisible(!1);r.push({bg:u,icon:p,minusBtn:f,minusText:x,plusBtn:S,plusText:y,countText:m,priceText:g,asset:t.asset,price:t.price}),a.push(f),o.push(S),l.push(g),h[t.asset]=m})),e.add.rectangle(e.cameras.main.width/2,e.cameras.main.height/2+180,450,60,3355443).setDepth(501).setOrigin(.5).setVisible(!1);let c=e.add.text(e.cameras.main.width/2-100,e.cameras.main.height/2+180,"TOTAL:",{fontFamily:'"Press Start 2P"',fontSize:"18px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(502).setVisible(!1);Se=e.add.text(e.cameras.main.width/2,e.cameras.main.height/2+180,"0",{fontFamily:'"Press Start 2P"',fontSize:"18px",color:"#FFD700"}).setDepth(502).setVisible(!1);let d=e.add.rectangle(e.cameras.main.width/2+150,e.cameras.main.height/2+180,120,40,2263842).setDepth(501).setOrigin(.5).setVisible(!1).setInteractive(),u=e.add.text(e.cameras.main.width/2+150,e.cameras.main.height/2+180,"PURCHASE",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(.5,.5).setDepth(502).setVisible(!1),k=e.add.text(e.cameras.main.width/2,e.cameras.main.height/2,"Insufficient Funds!",{fontFamily:'"Press Start 2P"',fontSize:"24px",color:"#FF0000",backgroundColor:"#000000",padding:{x:20,y:10}}).setOrigin(.5,.5).setDepth(1100).setVisible(!1);!function(e,t,i){i.close.setInteractive(),i.purchase.setInteractive(),i.items.forEach((e=>{e.plusBtn.setInteractive(),e.minusBtn.setInteractive(),e.plusBtn.on("pointerdown",(function(){const t=ve(e.asset);t.setValue(t.value+1);const s=ve(e.asset).value;e.countText.setText(`${s}`),Pe+=e.price,i.totalText.setText(`${Pe}`)})),e.minusBtn.on("pointerdown",(function(){const t=ve(e.asset);if(t.value>0){t.setValue(t.value-1);const s=ve(e.asset).value;e.countText.setText(`${s}`),Pe-=e.price,i.totalText.setText(`${Pe}`)}})),e.plusBtn.on("pointerover",(()=>e.plusBtn.setFillStyle(3050327))),e.plusBtn.on("pointerout",(()=>e.plusBtn.setFillStyle(2263842))),e.minusBtn.on("pointerover",(()=>e.minusBtn.setFillStyle(10824234))),e.minusBtn.on("pointerout",(()=>e.minusBtn.setFillStyle(9109504)))})),i.purchase.on("pointerdown",(function(){0==Ke(Pe)?(i.noFunds.setVisible(!0),e.time.delayedCall(2e3,(()=>i.noFunds.setVisible(!1)))):(i.items.forEach((e=>{const t=ve(e.asset);t.value>0&&(function(e,t){switch(e){case"hose":g(t);break;case"extinguisher":f(t);break;case"helicopter":S(t);break;case"firetruck":b(t);break;case"airtanker":F(t);break;case"hotshotcrew":I(t);break;case"smokejumper":P(t)}}(e.asset,t.value),t.setValue(0),e.countText.setText("0"))})),Ee.setText(p()),Me.setText(m()),_e.setText(x()),Oe.setText(y()),Ae.setText(w()),De.setText(T()),Re.setText(C()),X.setText(`${je()}`),i.totalText.setText("0"),Pe=0)})),t.on("pointerdown",(function(){Je(He),e.input.setDefaultCursor("url(assets/cursors/glove.png), pointer"),ke(i,!0)})),i.close.on("pointerdown",(function(){!function(e){ye=0,be=0,we=0,Fe=0,Te=0,Ie=0,Ce=0,e.items.forEach((e=>{e.countText.setText("0")})),Pe=0,e.totalText.setText("0")}(i),ke(i,!1)})),i.close.on("pointerover",(()=>i.close.setFillStyle(10824234))),i.close.on("pointerout",(()=>i.close.setFillStyle(9109504))),i.purchase.on("pointerover",(()=>i.purchase.setFillStyle(3050327))),i.purchase.on("pointerout",(()=>i.purchase.setFillStyle(2263842)))}(e,Le,{panel:t,title:i,close:s,closeText:n,items:r,totalLabel:c,totalText:Se,purchase:d,purchaseText:u,noFunds:k})}(s),de=s.add.sprite(s.game.scale.width-50,40,"hose").setScale(1.04).setDepth(1).setOrigin(.5,.5),de.name="hose",He[0]=de,Ee=function(e,t,i,s){const n=s.add.text(t,80,"10 left",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF",align:"center",backgroundColor:"#333333",padding:{x:6,y:4}}).setOrigin(.5,.5);return s.add.rectangle(t,80,n.width+12,n.height+8,3355443,.7).setOrigin(.5).setDepth(n.depth-1),n}(0,s.game.scale.width-50,0,s),Ne=s.add.sprite(s.game.scale.width-50,50,"set-timer").setDepth(1).setScale(1.04).setVisible(!1),et(0,de,"hose","assets/cursors/water.png","assets/cursors/glove.png","WATER","NO-WATER",s),K=Be(Ee,s),tt(de,"hose-tooltip",s.game.scale.width-155,45,s),ue=s.add.image(s.game.scale.width-50,125,"extinguisher").setScale(1.04).setOrigin(.5,.5),ue.name="extinguisher",He[1]=ue,Me=s.add.text(s.game.scale.width-50,165,"5 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,ue,"extinguisher","assets/cursors/fire-extinguisher.png","assets/cursors/glove.png","WATER","NO-WATER",s),J=Be(Me,s),tt(ue,"extinguisher-tooltip",s.game.scale.width-155,130,s),pe=s.add.image(s.game.scale.width-50,210,"helicopter").setScale(1.04).setOrigin(.5,.5),pe.name="helicopter",He[2]=pe,_e=s.add.text(s.game.scale.width-50,250,"3 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,pe,"helicopter","assets/cursors/helicopter.png","assets/cursors/glove.png","WATER","NO-WATER",s),q=Be(_e,s),tt(pe,"helicopter-tooltip",s.game.scale.width-155,215,s),ge=s.add.image(s.game.scale.width-50,295,"firetruck").setScale(1.04).setOrigin(.5,.5),ge.name="firetruck",He[3]=ge,Oe=s.add.text(s.game.scale.width-50,335,"3 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,ge,"firetruck","assets/cursors/firetruck.png","assets/cursors/glove.png","WATER","NO-WATER",s),Q=Be(Oe,s),tt(ge,"firetruck-tooltip",s.game.scale.width-155,300,s),me=s.add.image(s.game.scale.width-50,380,"airtanker").setScale(1.04).setOrigin(.5,.5),me.name="airtanker",He[4]=me,Ae=s.add.text(s.game.scale.width-50,420,"2 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,me,"airtanker","assets/cursors/airtanker.png","assets/cursors/glove.png","WATER","NO-WATER",s),ee=Be(Ae,s),tt(me,"airtanker-tooltip",s.game.scale.width-155,385,s),fe=s.add.image(s.game.scale.width-50,465,"hotshot-crew").setScale(1.04).setOrigin(.5,.5),fe.name="hotshot-crew",He[5]=fe,De=s.add.text(s.game.scale.width-50,505,"1 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,fe,"hotshot-crew","assets/cursors/hotshot-crew.png","assets/cursors/glove.png","WATER","NO-WATER",s),te=Be(De,s),tt(fe,"hotshot-crew-tooltip",s.game.scale.width-155,470,s),xe=s.add.image(s.game.scale.width-50,550,"smokejumper").setScale(1.04).setOrigin(.5,.5),xe.name="smokejumper",He[6]=xe,Re=s.add.text(s.game.scale.width-50,590,"5 left",{font:"14px Arial",fill:"#ffffff",align:"center",wordWrap:{width:80}}).setOrigin(.5,.5),et(0,xe,"smokejumper","assets/cursors/launch.png","assets/cursors/glove.png","WATER","NO-WATER",s),ie=Be(Re,s),tt(xe,"smokejumper-tooltip",s.game.scale.width-155,555,s),this.bottomBarContainer.add([Ue,X,Le]),Ue.setPosition(window.innerWidth-450,0).setDepth(10),X.setPosition(window.innerWidth-435,0).setDepth(10),Le.setPosition(this.scale.width-360,0).setDepth(10),Ue.setDepth(1),X.setDepth(1),Le.setDepth(Le.depth+1),this.uiContainer.add([this.topBarContainer,this.bottomBarContainer]),this.input.keyboard.on("keydown-U",(()=>{this.toggleUI(!this.uiContainer.visible)})),this.hoseText=Ee,this.extinguisherText=Me,this.helicopterText=_e,this.firetruckText=Oe,this.airtankerText=Ae,this.hotshotcrewText=De,this.smokejumperText=Re,this.scene.get("MapScene").events.on("updateGameClock",this.updateGameClock,this),this.scene.get("MapScene").events.on("tileInfo",this.updateTileInfo,this),this.scene.get("MapScene").events.on("fireSimToggled",this.updateFireButton,this),this.scene.get("MapScene").events.on("zoomChanged",this.handleZoomChange,this),this.scene.get("MapScene").events.on("mapSizeChanged",this.updateMapInfo,this),this.scene.get("MapScene").events.on("scoreUpdated",this.updateScore,this),this.scene.get("MapScene").events.on("gameWon",(()=>{this.winText.setVisible(!0)}))}update(){j.x=this.scale.width-55,de.x=this.scale.width-50,Ee.x=this.scale.width-50,K.x=this.scale.width-50,ue.x=this.scale.width-50,Me.x=this.scale.width-50,J.x=this.scale.width-50,pe.x=this.scale.width-50,_e.x=this.scale.width-50,q.x=this.scale.width-50,ge.x=this.scale.width-50,Oe.x=this.scale.width-50,Q.x=this.scale.width-50,me.x=this.scale.width-50,Ae.x=this.scale.width-50,ee.x=this.scale.width-50,fe.x=this.scale.width-50,De.x=this.scale.width-50,te.x=this.scale.width-50,xe.x=this.scale.width-50,Re.x=this.scale.width-50,ie.x=this.scale.width-50,Ue.x=this.scale.width-170,X.x=this.scale.width-155,Le.x=this.scale.width-260,this.pauseText.x=this.scale.width/2,this.hoseText&&(this.hoseText.setText(`${p()} left`),this.extinguisherText.setText(`${m()} left`),this.helicopterText.setText(`${x()} left`),this.firetruckText.setText(`${y()} left`),this.airtankerText.setText(`${w()} left`),this.hotshotcrewText.setText(`${T()} left`),this.smokejumperText.setText(`${C()} left`)),this.updateInfoPanel()}toggleUI(e=!0){this.uiContainer.setVisible(e),this.uiToggleButtonContainer.setVisible(!0);const t=e?"toggle_ui_on":"toggle_ui_off";this.uiToggleButton&&this.uiToggleButton.setTexture(t)}_createTooltip(e,t,i=-20){const s=this.add.text(0,0,t,{font:"14px Arial",fill:"#fff",backgroundColor:"#000",padding:{x:6,y:4}}).setOrigin(.5,1).setDepth(1e3).setScrollFactor(0).setVisible(!1);return e.on("pointerover",(()=>{s.setPosition(e.x,e.y+i).setVisible(!0)})).on("pointerout",(()=>s.setVisible(!1))),s}createUIElements(){this.riskText=this.add.text(-500,-500,"Risk: Low",{fontFamily:'"Press Start 2P"',fontSize:"16px",fontStyle:"normal",fill:"#00ff00",backgroundColor:"rgba(0,0,0,0.5)",padding:{x:4,y:2}}).setScrollFactor(0),this.gameClockText=this.add.text(this.GAME_CLOCK_X,this.GAME_CLOCK_Y,"Time: 00:00",{fontSize:"20px",fill:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.6)",padding:{x:10,y:6},align:"center",shadow:{offsetX:2,offsetY:2,color:"rgba(0, 0, 0, 0.7)",blur:4,stroke:!0,fill:!0}}).setScrollFactor(0).setDepth(10),this.uiContainer.add(this.gameClockText);const e=this.add.rectangle(400,40,150,8,3355443).setOrigin(.5,0).setScrollFactor(0);this.fireStepBar=this.add.rectangle(325,45,0,8,16729344).setOrigin(0,0).setScrollFactor(0),this.topBarContainer.add([e,this.fireStepBar]),this.tileInfoText=this.add.text(-500,-500,"Select tile",{fontFamily:'"Press Start 2P"',fontSize:"16px",fontStyle:"bold",fill:"#ffff00",backgroundColor:"rgba(0, 0, 0, 0.85)",padding:{x:16,y:12},align:"left",shadow:{offsetX:2,offsetY:2,color:"#000000",blur:4,stroke:!0,fill:!0}}).setDepth(-1).setScrollFactor(0),this.scoreText=this.add.text(550,15,"Score: 0",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.5)",padding:{x:8,y:4}}).setScrollFactor(0),this.topBarContainer.add(this.scoreText),this.winText=this.add.text(this.scale.width/2,this.scale.height/2,"YOU WIN!",{fontFamily:'"Press Start 2P"',fontSize:"24px",fill:"#00FF00",backgroundColor:"rgba(0,0,0,0.8)",padding:{x:20,y:10},align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(1e3).setVisible(!1),this.uiContainer.add(this.winText),this.directionPromptContainer=this.add.container(this.SCREEN_WIDTH/2,this.SCREEN_HEIGHT/2).setScrollFactor(0).setDepth(1001).setVisible(!1);const t=this.add.rectangle(0,0,350,200,0,.8).setOrigin(.5),i=this.add.text(0,-82,"Choose Drop Direction",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5),s={fontFamily:'"Press Start 2P"',fontSize:"14px",color:"#ffffff",backgroundColor:"#444",padding:{x:14,y:8}},n=this.add.text(0,-40,"Vertical",s).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.directionPromptContainer.setVisible(!1),this.events.emit("directionChosen","vertical")})),r=this.add.text(0,0,"Horizontal",s).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.directionPromptContainer.setVisible(!1),this.events.emit("directionChosen","horizontal")})),a=this.add.text(0,40,"Cancel",s).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.directionPromptContainer.setVisible(!1),this.events.emit("directionChosen",null)}));this.directionPromptContainer.add([t,i,n,r,a]),this.uiContainer.add(this.directionPromptContainer),this.fieldManualContainer=this.add.container(0,0).setDepth(100).setVisible(!1);const o=this.add.rectangle(400,300,600,500,0,.9);o.setStrokeStyle(2,16777215);const l=this.add.graphics().fillStyle(16777215).fillRect(120,70,560,460);l.setVisible(!1);const h=this.add.text(120,70,"\nðŸ”¥ WILDFIRE CONTROL FIELD MANUAL ðŸ”¥\n\nTERRAIN TYPES & BEHAVIOR\n-----------------------\nðŸŒ³ Trees\n- Low flammability\n- High fuel content (6)\n- Burns slowly but intensely\n- Includes: Dirt House ðŸ  (fuel 6)\n- Best controlled with: Smokejumpers, Hotshot Crews, Airtankers\n\nðŸŒ¿ Shrubs\n- High flammability\n- Medium fuel content (4)\n- Moderate burn rate\n- Includes: Sand House ðŸ  (fuel 4)\n- Best controlled with: Firetrucks\n\nðŸŒ± Grass\n- Medium flammability\n- Low fuel content (2)\n- Burns quickly\n- Includes: Grass House ðŸ  (fuel 2)\n- Best controlled with: Water Hoses, Fire Extinguishers\n\nðŸ’§ Water\n- No flammability or fuel\n- Natural firebreak\n\nFIREFIGHTING RESOURCES\n---------------------\nðŸ’§ Water Hose\n- Reduces 3 fuel per use\n- Single tile range\n- Fast deployment, short cooldown\n- May require multiple uses on high-fuel terrain\n\nðŸ§¯ Fire Extinguisher\n- Reduces 2 fuel per use\n- Single tile range\n- Extremely fast, lowest cost\n- Best for light fuels like grass\n\nðŸš’ Firetruck\n- Reduces 4 fuel per use\n- Single tile range\n- Strong vs shrubs and most structures\n\nðŸš Helicopter\n- Instantly extinguishes 5 tiles in a cross pattern\n- Ignores fuel amount â€” guaranteed to put out fire\n- Best for clustered fires\n\nâœˆï¸ Airtanker\n- Instantly extinguishes a 5-tile line (horizontal or vertical)\n- Bypasses fuel â€” great for fire lines or dense terrain\n\nðŸ‘¥ Hotshot Crew\n- Converts 5-tile line into firebreaks\n- Must be deployed on unburned, flammable terrain\n- Prevents future spread, does not extinguish\n\nðŸª‚ Smokejumpers\n- Instantly extinguish a single burning tile\n- Always successful regardless of fuel\n- Ideal for remote or high-priority targets\n\n\nSTRATEGIC TIPS\n-------------\n1. Create firebreaks AHEAD of the fire\n2. Use terrain and water to slow spread\n3. Prioritize saving structures\n4. Watch wind direction closely\n5. Coordinate multiple assets for best results\n\nPress 'F' to close manual\n",{fontSize:"16px",wordWrap:{width:560},color:"#FFFFFF",lineSpacing:5}).setMask(new Phaser.Display.Masks.GeometryMask(this,l)),c=this.add.text(400,75,"â–²",{fontSize:"20px",color:"#FFFFFF"}).setOrigin(.5,0).setAlpha(.7).setVisible(!1),d=this.add.text(400,525,"â–¼",{fontSize:"20px",color:"#FFFFFF"}).setOrigin(.5,1).setAlpha(.7).setVisible(!1),u={startY:70,minY:70,maxY:-Math.max(0,h.height-440),currentY:70,scrollSpeed:15},p=()=>{c.setVisible(h.y<u.startY),d.setVisible(h.y>u.maxY)};this.input.on("wheel",((e,t,i,s)=>{if(!this.fieldManualContainer.visible)return void(this.scene.get("MapScene").disableZoom=!1);e.event.stopPropagation(),e.event.preventDefault();const n=Phaser.Math.Clamp(h.y-Math.sign(s)*u.scrollSpeed,u.maxY,u.startY);h.y=n,p()}));let g=!1,m=0,f=0;h.setInteractive({draggable:!1}),h.on("pointerdown",(e=>{g=!0,m=e.y,f=h.y})),this.input.on("pointerup",(()=>{g=!1})),this.input.on("pointermove",(e=>{if(!g||!this.fieldManualContainer.visible)return;const t=e.y-m,i=Phaser.Math.Clamp(f+t,u.maxY,u.startY);h.y=i,p()})),this.fieldManualContainer.on("setVisible",(e=>{const t=this.scene.get("MapScene");e?(h.y=u.startY,p(),t.disableZoom=!0):t.disableZoom=!1}));const x=this.add.text(400,510,"Use mouse wheel to scroll",{fontSize:"12px",color:"#888888",backgroundColor:"#000000",padding:{x:10,y:5}}).setOrigin(.5);this.fieldManualContainer.add([o,l,h,c,d,x]);const S=this.add.container(670,65).setScrollFactor(0),y=this.add.text(4,4,"âŒ",{fontSize:"24px",color:"#ffffff",padding:{top:6,bottom:0}}).setOrigin(.5).setInteractive();y.on("pointerover",(()=>{this.tweens.add({targets:y,scale:1.2,duration:100,ease:"Power1"})})),y.on("pointerout",(()=>{this.tweens.add({targets:y,scale:1,duration:100,ease:"Power1"})})),y.on("pointerdown",(()=>{this.fieldManualContainer.setVisible(!1),this.scene.get("MapScene").disableZoom=!1})),S.add(y),this.fieldManualContainer.add(S),this.input.keyboard.on("keydown-F",(()=>{if(!["LoginScene","SignupScene","ProfileScene","LeaderboardScene"].some((e=>this.scene.isActive(e)))){const e=this.fieldManualContainer.visible;this.fieldManualContainer.setVisible(!e),this.scene.get("MapScene").disableZoom=!e}}));const b=this.add.text(492,-16,"ðŸ“–",{fontSize:"36px"}).setInteractive().on("pointerdown",(()=>{const e=this.fieldManualContainer.visible;this.fieldManualContainer.setVisible(!e),this.scene.get("MapScene").disableZoom=!e})).setScrollFactor(0);this._createTooltip(b,"Field Manual (F)"),this.bottomBarContainer.add(b),this.weatherPanel=this.add.container(20,70);const w=this.add.rectangle(0,0,250,60,0,.7).setOrigin(0,0).setStrokeStyle(1,16777215);this.riskText=this.add.text(10,10,"",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(0,0),this.windText=this.add.text(10,30,"",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(0,0),this.windLabel=this.add.text(this.WIND_GAUGE_X-8,this.WIND_GAUGE_Y+this.WIND_GAUGE_HEIGHT/2,"Wind:",{fontFamily:'"Press Start 2P"',fontSize:"14px",color:"#FFFFFF"}).setOrigin(1,.5).setScrollFactor(0),this.windGaugeBg=this.add.rectangle(this.WIND_GAUGE_X,this.WIND_GAUGE_Y,this.WIND_GAUGE_WIDTH,this.WIND_GAUGE_HEIGHT,8947848,.7).setOrigin(0,0).setScrollFactor(0),this.windGaugeFill=this.add.rectangle(this.WIND_GAUGE_X,this.WIND_GAUGE_Y,0,this.WIND_GAUGE_HEIGHT,65280,1).setOrigin(0,0).setScrollFactor(0),this.windArrow=this.add.image(this.WIND_GAUGE_X+this.WIND_GAUGE_WIDTH+10,this.WIND_GAUGE_Y+this.WIND_GAUGE_HEIGHT/2,"wind-arrow").setDisplaySize(this.WIND_GAUGE_HEIGHT,this.WIND_GAUGE_HEIGHT).setOrigin(.5).setScrollFactor(0),this.weatherPanel.add([w,this.riskText,this.windText,this.windGaugeBg,this.windGaugeFill,this.windArrow,this.windLabel]),this.topBarContainer.add(this.weatherPanel),this.updateInfoPanel(),this.tileInfoPanel=this.add.container(20,140);const F=this.add.rectangle(0,0,250,40,0,.7).setOrigin(0,0).setStrokeStyle(1,16777215);this.tileInfoText=this.add.text(10,10,"Click a tile for info",{fontFamily:'"Press Start 2P"',fontSize:"10px",color:"#888888",wordWrap:{width:230}}).setOrigin(0,0),this.tileInfoPanel.add([F,this.tileInfoText]),this.topBarContainer.add(this.tileInfoPanel),this.fireStepContainer=this.add.container(0,0).setDepth(11),this.fireStepText=this.add.text(400,40,"Next Fire Spread: 20s",{fontFamily:'"Press Start 2P"',fontSize:"10px",color:"#FFFFFF",align:"center"}).setOrigin(.5,0),this.fireWarningText=this.add.text(400,60,"FIRE SPREADING!",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FF0000",align:"center",backgroundColor:"#000000",padding:{x:10,y:5}}).setOrigin(.5,0).setVisible(!1),this.fireStepContainer.add([this.fireStepText,this.fireWarningText]),this.topBarContainer.add(this.fireStepContainer)}createZoomControls(){const e=r(this,{x:200,y:0,width:40,height:40,backgroundColor:6710886,hoverColor:8947848,text:"+",fontSize:"20px",onClick:()=>{const e=this.scene.get("MapScene");e.currentZoom=Phaser.Math.Clamp(e.currentZoom+.1,e.MIN_ZOOM,e.MAX_ZOOM),e.cameras.main.setZoom(e.currentZoom),this.handleZoomChange(e.currentZoom)}}),t=r(this,{x:260,y:0,width:40,height:40,backgroundColor:6710886,hoverColor:8947848,text:"-",fontSize:"20px",onClick:()=>{const e=this.scene.get("MapScene");e.currentZoom=Phaser.Math.Clamp(e.currentZoom-.1,e.MIN_ZOOM,e.MAX_ZOOM),e.cameras.main.setZoom(e.currentZoom),this.handleZoomChange(e.currentZoom)}});this.uiToggleButton=this.add.image(-60,420,"toggle_ui_on").setInteractive().setScrollFactor(0).setDisplaySize(32,32).on("pointerover",(()=>this.uiToggleButton.setTint(12303291))).on("pointerout",(()=>this.uiToggleButton.clearTint())).on("pointerdown",(()=>{const e=!this.uiContainer.visible;this.toggleUI(e);const t=e?"toggle_ui_on":"toggle_ui_off";this.uiToggleButton.setTexture(t)})),this.uiToggleButtonContainer=this.add.container(650,this.scale.height-60,[this.uiToggleButton]).setScrollFactor(0);const i=this.add.graphics();i.fillStyle(5592405,1),i.fillRoundedRect(-25,-25,50,50,8),i.setInteractive(new Phaser.Geom.Rectangle(-25,-25,50,50),Phaser.Geom.Rectangle.Contains),i.on("pointerover",(()=>{i.clear(),i.fillStyle(7829367,1),i.fillRoundedRect(-25,-25,50,50,8)})),i.on("pointerout",(()=>{i.clear(),i.fillStyle(5592405,1),i.fillRoundedRect(-25,-25,50,50,8)})),this.uiToggleButtonContainer.removeAll(),this.uiToggleButton.setPosition(0,0),this.uiToggleButtonContainer.add([i,this.uiToggleButton]),this.zoomText=this.add.text(170,40,"Zoom: 100%",{fontFamily:'"Press Start 2P"',fontSize:"12px",fontStyle:"normal",color:"#FFFFFF"}).setOrigin(0,.5).setScrollFactor(0),this.zoomInButton=e.button,this.zoomOutButton=t.button,this.bottomBarContainer.add(this.zoomText),this.bottomBarContainer.add([e.button,e.buttonText,t.button,t.buttonText]);const s=this.add.graphics();s.fillStyle(5592405,1),s.fillRoundedRect(-25,-25,50,50,8),s.setInteractive(new Phaser.Geom.Rectangle(-25,-25,50,50),Phaser.Geom.Rectangle.Contains),s.on("pointerover",(()=>{s.clear(),s.fillStyle(7829367,1),s.fillRoundedRect(-25,-25,50,50,8)})),s.on("pointerout",(()=>{s.clear(),s.fillStyle(5592405,1),s.fillRoundedRect(-25,-25,50,50,8)}));const n=this.add.text(0,0,"i",{fontFamily:'"Press Start 2P"',fontSize:"20px",color:"#FFFFFF"}).setOrigin(.5);this.infoButtonContainer=this.add.container(575,this.scale.height-60,[s,n]).setScrollFactor(0),this.infoButtonContainer.setDepth(100),this.infoPanel=this.add.container(175,175).setScrollFactor(0).setVisible(!1);const a=this.add.rectangle(0,0,300,200,3355443,.9).setOrigin(.5).setStrokeStyle(2,16777215),o=this.add.text(130,-85,"X",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.infoPanel.setVisible(!1)}));this.infoPanelTitle=this.add.text(0,-85,"Game Info",{fontFamily:'"Press Start 2P"',fontSize:"16px",color:"#FFFFFF"}).setOrigin(.5),this.infoPanelTile=this.add.text(-130,-60,"Tile: N/A",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(0,0),this.infoPanelWind=this.add.text(-130,0,"Wind: N/A",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(0,0),this.infoPanelRisk=this.add.text(-130,60,"Risk: N/A",{fontFamily:'"Press Start 2P"',fontSize:"12px",color:"#FFFFFF"}).setOrigin(0,0),this.infoPanel.add([a,this.infoPanelTitle,o,this.infoPanelTile,this.infoPanelWind,this.infoPanelRisk]),this.uiContainer.add(this.infoPanel),s.on("pointerdown",(()=>{const e=!this.weatherPanel.visible;this.weatherPanel.setVisible(e),this.tileInfoPanel.setVisible(e)}))}createNavigationCompass(){const e=-250,t=[{key:"up",x:0,y:-1,posX:120,posY:-325},{key:"right",x:1,y:0,posX:195,posY:e},{key:"down",x:0,y:1,posX:120,posY:-175},{key:"left",x:-1,y:0,posX:45,posY:e}],i=this.add.circle(120,e,10,5592405).setScrollFactor(0);this.bottomBarContainer.add(i),t.forEach((e=>{const t=this.add.image(e.posX,e.posY,e.key).setDisplaySize(70,70).setScrollFactor(0).setInteractive().on("pointerdown",(()=>this.events.emit("panStart",{x:e.x,y:e.y}))).on("pointerup",(()=>this.events.emit("panStop"))).on("pointerout",(()=>this.events.emit("panStop")));this.bottomBarContainer.add(t)}))}updateFireProgress(e){if(!this.fireStepText)return;const t=Math.ceil(20*(1-e/100));let i="#FFFFFF";e>85?(i="#FF0000",this.fireWarningText.setVisible(!0)):e>60?(i="#FF8C00",this.fireWarningText.setVisible(!1)):this.fireWarningText.setVisible(!1),this.fireStepText.setText(`Next Fire Spread: ${t}s`).setColor(i)}updateScore(e){this.scoreText&&this.scoreText.setText(`Score: ${e}`)}updateGameClock(e){let t=Math.floor(e/60),i=Math.floor(e%60),s=`${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}`;this.gameClockText.setText(`Time: ${s}`)}updateTileInfo(e){if(!this.tileInfoText)return;let t=`ðŸ“ ${this.getTerrainName(e.terrain)}`;"number"==typeof e.initialFuel&&e.initialFuel>0&&(t+=`\nâ›½ Fuel: ${this.generateFuelText(e.fuel,e.initialFuel)}`),this.tileInfoText.setText(t).setColor("#FFFFFF"),this.tileInfoHideTimer&&(this.tileInfoHideTimer.remove(),this.tileInfoHideTimer=null)}updateFireButton(e){this.fireButton&&this.fireButton.buttonText&&this.fireButton.buttonText.setText(e?"Stop":"Start"),this.pauseText&&this.pauseText.setVisible(!e)}updateRiskDisplay(e){this.riskText.setText(`Risk: ${e.charAt(0).toUpperCase()+e.slice(1)}`).setStyle({fill:{low:"#00ff00",medium:"#ffff00",high:"#ff0000"}[e]})}handleZoomChange(e){const t=Math.round(100*e);this.zoomText.setText(`Zoom: ${t}%`)}updateMapInfo(e){console.log(`Map size changed: ${e.width}x${e.height} tiles, ${e.pixelWidth}x${e.pixelHeight} pixels`)}updateInfoPanel(){const e=this.scene.get("MapScene").weather;if(!e)return;const t=e.getRiskCategory().toUpperCase(),i={LOW:"#00ff00",MEDIUM:"#ffff00",HIGH:"#ff0000"}[t];this.riskText.setText(`Fire Risk: ${t}`).setColor(i);const s=Phaser.Math.Clamp(e.windSpeed/50,0,1);this.windGaugeFill.width=this.WIND_GAUGE_WIDTH*s,this.windGaugeFill.fillColor=s<.33?65280:s<.66?16776960:16711680;const n={N:-90,E:0,S:90,W:180}[e.windDirection]??0;this.windArrow.setRotation(Phaser.Math.DegToRad(n))}getTerrainName(e){return e.startsWith("burned-")?{tree:"ðŸ”¥ Burned Forest",shrub:"ðŸ”¥ Burned Shrubland",grass:"ðŸ”¥ Burned Grassland","dirt-house":"ðŸ”¥ Burned Structure","grass-house":"ðŸ”¥ Burned Structure","sand-house":"ðŸ”¥ Burned Structure",house:"ðŸ”¥ Burned Structure"}[e.slice(7)]||"ðŸ”¥ Burned Area":{tree:"ðŸŒ³ Forest",shrub:"ðŸŒ¿ Shrubland",grass:"ðŸŒ± Grassland","dirt-house":"ðŸ  Structure","grass-house":"ðŸ  Structure","sand-house":"ðŸ  Structure",water:"ðŸ’§ Water","fire-break":"ðŸš§ Firebreak"}[e]||e}}class Pt extends s.Scene{constructor(){super({key:"SignupScene"})}preload(){}create(){this.input.keyboard.removeCapture([s.Input.Keyboard.KeyCodes.W,s.Input.Keyboard.KeyCodes.A,s.Input.Keyboard.KeyCodes.S,s.Input.Keyboard.KeyCodes.D]),this.scene.bringToTop();const{width:e,height:t}=this.scale;this.add.rectangle(0,0,e,t,0,.9).setOrigin(0).setInteractive(),this.add.text(400,120,"Sign Up",{fontSize:"25px",fill:"#FFD700",fontFamily:'"Press Start 2P", cursive',stroke:"#000",strokeThickness:4}).setOrigin(.5);const i={};[{placeholder:"Username",y:180,type:"text"},{placeholder:"Email",y:230,type:"email"},{placeholder:"Password",y:280,type:"password"},{placeholder:"Repeat Password",y:330,type:"password"}].forEach((e=>{const t=this.add.dom(400,e.y,"input",{width:"500px",height:"30px",fontSize:"16px",padding:"5px"}).setOrigin(.5);t.node.setAttribute("type",e.type),t.node.setAttribute("placeholder",e.placeholder),t.node.classList.add("input-field"),i[e.placeholder]=t}));const n=this.add.dom(470,390,"button",{width:"140px",height:"30px",fontSize:"12px",color:"#FFFFFF",backgroundColor:"#228B22",fontFamily:'"Press Start 2P", cursive',border:"2px solid #FFFFFF",cursor:"pointer"},"SIGN UP").setOrigin(.5);n.addListener("click"),n.on("click",(()=>{const e=i.Username.node.value.trim(),t=i.Email.node.value.trim(),s=i.Password.node.value,n=i["Repeat Password"].node.value;e&&t&&s&&n?s===n?(0,gt.eJ)(xt,t,s).then((async t=>{const i=t.user;await(0,gt.r7)(i,{displayName:e}),await(0,mt.BN)((0,mt.H9)(St,"users",i.uid),{displayName:e,email:i.email,createdAt:new Date}),this.scene.start("MapScene"),this.scene.launch("UIScene"),this.startGame()})).catch((e=>alert("Sign up failed: "+e.message))):alert("Passwords do not match."):alert("Please fill in all fields.")}));const r=this.add.dom(315,390,"button",{width:"140px",height:"30px",fontSize:"12px",color:"#FFFFFF",backgroundColor:"#555555",fontFamily:'"Press Start 2P", cursive',border:"2px solid #FFFFFF",cursor:"pointer"},"<--").setOrigin(.5);r.addListener("click"),r.on("click",(()=>{this.scene.start("LoginScene")}));const a=this.add.text(30,10,"âœ•",{fontSize:"24px",color:"#fff",backgroundColor:"transparent",fontFamily:'"Press Start 2P", cursive'}).setOrigin(1,0).setInteractive({useHandCursor:!0}).setDepth(1e3).on("pointerdown",(()=>this.scene.stop()));a.on("pointerover",(()=>a.setStyle({color:"#f00"}))),a.on("pointerout",(()=>a.setStyle({color:"#fff"})))}startGame(){console.log("Restarting game..."),sessionStorage.setItem("skipIntro","true"),window.location.reload()}}class kt extends s.Scene{constructor(){super({key:"LoginScene"})}preload(){}create(){this.input.keyboard.removeCapture([s.Input.Keyboard.KeyCodes.W,s.Input.Keyboard.KeyCodes.A,s.Input.Keyboard.KeyCodes.S,s.Input.Keyboard.KeyCodes.D]),this.scene.bringToTop();const{width:e,height:t}=this.scale;this.add.rectangle(0,0,e,t,0,.9).setOrigin(0).setInteractive(),this.input.keyboard.removeCapture([s.Input.Keyboard.KeyCodes.W,s.Input.Keyboard.KeyCodes.A,s.Input.Keyboard.KeyCodes.S,s.Input.Keyboard.KeyCodes.D]),this.add.text(400,150,"Log In",{fontSize:"25px",fill:"#FFD700",fontFamily:'"Press Start 2P", cursive',stroke:"#000",strokeThickness:4}).setOrigin(.5).setDepth(1e3);const i=this.add.dom(400,200,"input",{width:"500px",height:"30px",fontSize:"16px",padding:"5px"}).setOrigin(.5);i.node.setAttribute("type","email"),i.node.setAttribute("name","email"),i.node.setAttribute("placeholder","Email"),i.node.classList.add("input-field");const n=this.add.dom(400,260,"input",{width:"500px",height:"30px",fontSize:"16px",padding:"5px"}).setOrigin(.5);n.node.setAttribute("type","password"),n.node.setAttribute("name","password"),n.node.setAttribute("placeholder","Password"),n.node.classList.add("input-field");const r=this.add.dom(470,320,"button",{width:"140px",height:"30px",fontSize:"12px",color:"#FFFFFF",backgroundColor:"#228B22",fontFamily:'"Press Start 2P", cursive',border:"2px solid #FFFFFF",cursor:"pointer"},"LOGIN").setOrigin(.5);r.addListener("click"),r.on("click",(()=>{const e=i.node.value,t=n.node.value;e&&t?(0,gt.x9)(xt,e,t).then((e=>{console.log("Login successful:",e),this.scene.start("MapScene"),this.scene.launch("UIScene"),this.startGame()})).catch((e=>{console.error("Login error:",e),alert(`Login failed: ${e.message}`)})):alert("Please enter both email and password.")}));const a=this.add.dom(315,320,"button",{width:"140px",height:"30px",fontSize:"12px",color:"#FFFFFF",backgroundColor:"#555555",fontFamily:'"Press Start 2P", cursive',border:"2px solid #FFFFFF",cursor:"pointer"},"NEW USER?").setOrigin(.5);a.addListener("click"),a.on("click",(()=>{this.scene.start("SignupScene")})),xt.onAuthStateChanged((e=>{e?(this.logoutButton=this.add.dom(50,20,"button",{width:"100px",height:"30px",fontSize:"12px",color:"#FFFFFF",backgroundColor:"#8B0000",fontFamily:'"Press Start 2P", cursive',border:"2px solid #FFFFFF",cursor:"pointer"},"LOGOUT").setOrigin(0,0),this.logoutButton.addListener("click"),this.logoutButton.on("click",(()=>{(0,gt.CI)(xt).then((()=>{console.log("User logged out"),this.startGame()})).catch((e=>console.error("Logout failed:",e)))}))):this.logoutButton&&(this.logoutButton.destroy(),this.logoutButton=null)}));const o=this.add.text(30,10,"âœ•",{fontSize:"24px",color:"#fff",backgroundColor:"transparent",fontFamily:'"Press Start 2P", cursive'}).setOrigin(1,0).setInteractive({useHandCursor:!0}).setDepth(1e3).on("pointerdown",(()=>this.scene.stop()));o.on("pointerover",(()=>o.setStyle({color:"#f00"}))),o.on("pointerout",(()=>o.setStyle({color:"#fff"})))}startGame(){console.log("Restarting game..."),sessionStorage.setItem("skipIntro","true"),window.location.reload()}}class vt extends s.Scene{constructor(){super({key:"ProfileScene"})}preload(){}async create(){const e=xt.currentUser,t=e?e.displayName:"Guest",i=.5*this.cameras.main.width,s=.38*this.cameras.main.height,{width:n,height:r}=this.scale;this.add.rectangle(0,0,n,r,0,.7).setOrigin(0).setInteractive();const a=this.scene.get("MapScene");if(!a||"function"!=typeof a.getTopNScores)return void console.warn("MapScene or getTopNScores not available");const o=(await a.getTopNScores(5)).map(((e,t)=>`<li style="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 4px 0;\n            border-bottom: 1px solid rgba(255,215,0,0.3);\n          ">\n            <span>#${t+1}</span>\n            <span>${e}</span>\n          </li>\n        `)).join("");if(this.scorePanel=this.add.dom(i,s,"div",{width:"500px",maxHeight:"500px",overflowY:"auto",backgroundColor:"rgba(0, 0, 0, 0.85)",border:"3px solid #FFFFFF",borderRadius:"10px",padding:"12px",boxSizing:"border-box",fontFamily:'"Press Start 2P", cursive',color:"#FFD700",textAlign:"center",fontSize:"16px"},"").setOrigin(.5),e){const e=`\n            <h2 style="text-align:center; margin:0 0 12px;">${t}'s High Scores</h2>\n\n            \x3c!-- header flex row --\x3e\n            <div class="leader-header" style="\n                display:flex;\n                justify-content:space-between;\n                font-weight:bold;\n                padding:6px 0;\n                border-bottom:2px solid #FFD700;\n            ">\n                <span>Rank</span>\n                <span>Score</span>\n            </div>\n\n            <ol class="score-list">\n                ${o}\n            </ol>\n        `;this.scorePanel.node.innerHTML=e}else{const e="\n        <h2>Please sign up if would like to save your scores</h2>\n    ";this.scorePanel.node.innerHTML=e}this.scorePanel.node.classList.add("score-panel");const l=document.createElement("style");l.textContent="\n    .score-panel .score-list {\n        list-style-type: none !important;  /* remove default numbering */\n        margin: 0;\n        padding-left: 0 !important;        /* remove indent */\n    }\n    .score-panel .score-list li {\n        padding: 4px 0;                     /* vertical spacing */\n        border-bottom: 1px solid rgba(255,215,0,0.3);  /* subtle separators */\n        color: #FFFFFF;\n    }\n    .score-panel .score-list li:last-child {\n        border-bottom: none;                /* no line after last item */\n    }\n    .score-panel h2 {\n        color: #FFD700;\n        font-size: 20px;\n    }\n    ",document.head.append(l),this.scorePanel.node.clientHeight;const h=this.add.text(30,10,"âœ•",{fontSize:"24px",color:"#fff",backgroundColor:"transparent",fontFamily:'"Press Start 2P", cursive'}).setOrigin(1,0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.scene.stop()));h.on("pointerover",(()=>h.setStyle({color:"#f00"}))),h.on("pointerout",(()=>h.setStyle({color:"#fff"}))),this.scale.on("resize",(e=>{const{width:t,height:i}=e;this.scorePanel.setPosition(.5*t,.38*i)}))}}class Et extends s.Scene{constructor(){super({key:"LeaderboardScene"})}preload(){}async create(){xt.currentUser;const e=.5*this.cameras.main.width,t=.38*this.cameras.main.height,{width:i,height:s}=this.scale;this.add.rectangle(0,0,i,s,0,.7).setOrigin(0).setInteractive();const n=this.scene.get("MapScene");if(!n||"function"!=typeof n.getGlobalTopNScores)return void console.warn("MapScene or getGlobalTopNScores not available");const r=(await n.getGlobalTopNScores(5)).map((({displayName:e,score:t},i)=>`\n          <li style="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 4px 0;\n            border-bottom: 1px solid rgba(255,215,0,0.3);\n          ">\n            <span>#${i+1}</span>\n            <span>${e}</span>\n            <span>${t}</span>\n          </li>\n        `)).join("");this.scorePanel=this.add.dom(e,t,"div",{width:"600px",maxHeight:"400px",overflowY:"auto",backgroundColor:"rgba(0, 0, 0, 0.85)",border:"3px solid #FFFFFF",borderRadius:"10px",padding:"16px",boxSizing:"border-box",fontFamily:'"Press Start 2P", cursive',color:"#FFD700",textAlign:"left",fontSize:"16px",lineHeight:"1.4"},"").setOrigin(.5);const a=`\n      <h2 style="text-align:center; margin:0 0 12px;">Global Leaderboard</h2>\n\n      \x3c!-- header flex row --\x3e\n      <div class="leader-header" style="\n        display:flex;\n        justify-content:space-between;\n        font-weight:bold;\n        padding:6px 0;\n        border-bottom:2px solid #FFD700;\n      ">\n        <span>Rank</span>\n        <span>&nbsp;Name</span>\n        <span>Score</span>\n      </div>\n\n      <ol class="leader-list">\n        ${r}\n      </ol>\n    `;this.scorePanel.node.innerHTML=a,this.scorePanel.node.classList.add("leader-panel");const o=document.createElement("style");o.textContent="\n      .leader-panel .leader-list {\n        list-style-type: none;\n        margin: 0;\n        padding-left: 0;\n      }\n      .leader-panel .leader-list li {\n        padding: 6px 0;\n        border-bottom: 1px solid rgba(255,215,0,0.3);\n        color: #FFFFFF;\n      }\n      .leader-panel .leader-list li:last-child {\n        border-bottom: none;\n      }\n      .leader-panel h2 {\n        color: #FFD700;\n        font-size: 20px;\n      }\n      .leader-panel li strong {\n        color: #FFD700;\n      }\n    ",document.head.appendChild(o);const l=this.add.text(30,10,"âœ•",{fontSize:"24px",color:"#fff",backgroundColor:"transparent",fontFamily:'"Press Start 2P", cursive'}).setOrigin(1,0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.scene.stop()));l.on("pointerover",(()=>l.setStyle({color:"#f00"}))),l.on("pointerout",(()=>l.setStyle({color:"#fff"}))),this.scale.on("resize",(e=>{const{width:t,height:i}=e;this.scorePanel.setPosition(.5*t,.38*i)}))}}console.log("Phaser Game Initializing...");const Mt={type:s.AUTO,width:800,height:600,parent:"game-container",scene:[n,_,Pt,kt,bt,Ct,vt,Et],callbacks:{postBoot:function(e){e.canvas.style.width="100%",e.canvas.style.height="100%"}},backgroundColor:"#282c34",scale:{mode:s.Scale.EXPAND,autoCenter:s.Scale.CENTER_BOTH},dom:{createContainer:!0}};new s.Game(Mt)}},e=>{e.O(0,[401],(()=>e(e.s=980))),e.O()}]);